import{r as E,j as R,m as Ar,e as Gt,u as pr,a as mr,b as Br,c as vr,d as gr,i as Cr,E as Er,B as Mr,f as Tr,T as xr,V as y,g as U,Q as Me,M as pe,S as Rr,h as me,C as z,k as Fr,R as nt,l as Dr,n as Mt,o as Ks,L as zs,p as Ke,F as tt,q as re,s as Sr,P as br,D as Ir,I as yr,t as Gr,O as Qs,v as it,w as wr,x as ae,y as Hr,z as js,N as _r,A as Ur,G as Pr,H as te,J as Ye,K as Tt,U as Lr,W as Or,X as Nr,Y as ze,Z as Jr,_ as wt,$ as Je,a0 as Fe,a1 as kr,a2 as at,a3 as Kr,a4 as Ht,a5 as zr,a6 as Qr,a7 as jr,a8 as Xr,a9 as ft,aa as ot,ab as Yr,ac as Vr,ad as Wr,ae as Zr,af as qr,ag as $r,ah as Xs,ai as en,aj as Ie,ak as kt,al as Kt,am as zt,an as _t,ao as tn,ap as sn,aq as rn,ar as De,as as Ge,at as Z,au as ee,av as C,aw as j,ax as Ut,ay as xt,az as Ys,aA as nn,aB as Vs,aC as an,aD as on,aE as Pt,aF as se,aG as _,aH as ln,aI as cn,aJ as un,aK as hn,aL as fn,aM as Be,aN as Lt,aO as Ws,aP as Zs,aQ as ke,aR as dn,aS as qs,aT as An,aU as pn}from"./index-D1c_BR2-.js";function Rt(){return Rt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)({}).hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},Rt.apply(null,arguments)}function Qt(e,t){let s;return(...r)=>{window.clearTimeout(s),s=window.setTimeout(()=>e(...r),t)}}function mn({debounce:e,scroll:t,polyfill:s,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=s||(typeof window>"u"?class{}:window.ResizeObserver);if(!n)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[i,a]=E.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=E.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:i,orientationHandler:null}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,h=E.useRef(!1);E.useEffect(()=>(h.current=!0,()=>void(h.current=!1)));const[u,f,d]=E.useMemo(()=>{const m=()=>{if(!o.current.element)return;const{left:v,top:g,width:M,height:D,bottom:G,right:w,x:b,y:I}=o.current.element.getBoundingClientRect(),F={left:v,top:g,width:M,height:D,bottom:G,right:w,x:b,y:I};o.current.element instanceof HTMLElement&&r&&(F.height=o.current.element.offsetHeight,F.width=o.current.element.offsetWidth),Object.freeze(F),h.current&&!Cn(o.current.lastBounds,F)&&a(o.current.lastBounds=F)};return[m,c?Qt(m,c):m,l?Qt(m,l):m]},[a,r,l,c]);function A(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(m=>m.removeEventListener("scroll",d,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function p(){o.current.element&&(o.current.resizeObserver=new n(d),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(m=>m.addEventListener("scroll",d,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{d()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const B=m=>{!m||m===o.current.element||(A(),o.current.element=m,o.current.scrollContainers=$s(m),p())};return vn(d,!!t),Bn(f),E.useEffect(()=>{A(),p()},[t,d,f]),E.useEffect(()=>A,[]),[B,i,u]}function Bn(e){E.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function vn(e,t){E.useEffect(()=>{if(t){const s=e;return window.addEventListener("scroll",s,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",s,!0)}},[e,t])}function $s(e){const t=[];if(!e||e===document.body)return t;const{overflow:s,overflowX:r,overflowY:n}=window.getComputedStyle(e);return[s,r,n].some(i=>i==="auto"||i==="scroll")&&t.push(e),[...t,...$s(e.parentElement)]}const gn=["x","y","top","bottom","left","right","width","height"],Cn=(e,t)=>gn.every(s=>e[s]===t[s]);function En({ref:e,children:t,fallback:s,resize:r,style:n,gl:i,events:a=gr,eventSource:o,eventPrefix:l,shadows:c,linear:h,flat:u,legacy:f,orthographic:d,frameloop:A,dpr:p,performance:B,raycaster:m,camera:v,scene:g,onPointerMissed:M,onCreated:D,...G}){E.useMemo(()=>Gt(xr),[]);const w=pr(),[b,I]=mn({scroll:!0,debounce:{scroll:50,resize:0},...r}),F=E.useRef(null),K=E.useRef(null);E.useImperativeHandle(e,()=>F.current);const O=mr(M),[q,le]=E.useState(!1),[X,ce]=E.useState(!1);if(q)throw q;if(X)throw X;const N=E.useRef(null);Br(()=>{const ue=F.current;if(I.width>0&&I.height>0&&ue){N.current||(N.current=vr(ue));async function ut(){await N.current.configure({gl:i,scene:g,events:a,shadows:c,linear:h,flat:u,legacy:f,orthographic:d,frameloop:A,dpr:p,performance:B,raycaster:m,camera:v,size:I,onPointerMissed:(...he)=>O.current==null?void 0:O.current(...he),onCreated:he=>{he.events.connect==null||he.events.connect(o?Cr(o)?o.current:o:K.current),l&&he.setEvents({compute:(ve,H)=>{const J=ve[l+"X"],k=ve[l+"Y"];H.pointer.set(J/H.size.width*2-1,-(k/H.size.height)*2+1),H.raycaster.setFromCamera(H.pointer,H.camera)}}),D?.(he)}}),N.current.render(R.jsx(w,{children:R.jsx(Er,{set:ce,children:R.jsx(E.Suspense,{fallback:R.jsx(Mr,{set:le}),children:t??null})})}))}ut()}}),E.useEffect(()=>{const ue=F.current;if(ue)return()=>Tr(ue)},[]);const ct=o?"none":"auto";return R.jsx("div",{ref:K,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ct,...n},...G,children:R.jsx("div",{ref:b,style:{width:"100%",height:"100%"},children:R.jsx("canvas",{ref:F,style:{display:"block"},children:s})})})}function Mn(e){return R.jsx(Ar,{children:R.jsx(En,{...e})})}function Qe(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Ft(e,t){(t==null||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}function Tn(e,t){if(e){if(typeof e=="string")return Ft(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Ft(e,t)}}function xn(e){if(Array.isArray(e))return Ft(e)}function Rn(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Fn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dn(e){return xn(e)||Rn(e)||Tn(e)||Fn()}new y;new y;function Sn(e,t,s){return Math.max(t,Math.min(s,e))}function bn(e,t){return Sn(e-Math.floor(e/t)*t,0,t)}function In(e,t){var s=bn(t-e,Math.PI*2);return s>Math.PI&&(s-=Math.PI*2),s}function er(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Y=function e(t,s,r){var n=this;er(this,e),Qe(this,"dot2",function(i,a){return n.x*i+n.y*a}),Qe(this,"dot3",function(i,a,o){return n.x*i+n.y*a+n.z*o}),this.x=t,this.y=s,this.z=r},yn=[new Y(1,1,0),new Y(-1,1,0),new Y(1,-1,0),new Y(-1,-1,0),new Y(1,0,1),new Y(-1,0,1),new Y(1,0,-1),new Y(-1,0,-1),new Y(0,1,1),new Y(0,-1,1),new Y(0,1,-1),new Y(0,-1,-1)],jt=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Xt=new Array(512),Yt=new Array(512),Gn=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var s=0;s<256;s++){var r;s&1?r=jt[s]^t&255:r=jt[s]^t>>8&255,Xt[s]=Xt[s+256]=r,Yt[s]=Yt[s+256]=yn[r%12]}};Gn(0);function wn(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var s=0;s<t.length;s++)e=(e+(s+1)*(t.charCodeAt(s)%96))%2147483647}return e===0&&(e=311),e}function Vt(e){var t=wn(e);return function(){var s=t*48271%2147483647;return t=s,s/2147483647}}var Hn=function e(t){var s=this;er(this,e),Qe(this,"seed",0),Qe(this,"init",function(r){s.seed=r,s.value=Vt(r)}),Qe(this,"value",Vt(this.seed)),this.init(t)};new Hn(Math.random());var _n=function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/s)*Math.atan(Math.sin(2*Math.PI*t*n)/s)},tr=function(t){return 1/(1+t+.48*t*t+.235*t*t*t)},Un=function(t){return t},Pn={in:function(t){return 1-Math.cos(t*Math.PI/2)},out:function(t){return Math.sin(t*Math.PI/2)},inOut:function(t){return-(Math.cos(Math.PI*t)-1)/2}},Ln={in:function(t){return t*t*t},out:function(t){return 1-Math.pow(1-t,3)},inOut:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}},On={in:function(t){return t*t*t*t*t},out:function(t){return 1-Math.pow(1-t,5)},inOut:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}},Nn={in:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},out:function(t){return Math.sqrt(1-Math.pow(t-1,2))},inOut:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}},Jn={in:function(t){return t*t*t*t},out:function(t){return 1- --t*t*t*t},inOut:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t}},kn={in:function(t){return t===0?0:Math.pow(2,10*t-10)},out:function(t){return t===1?1:1-Math.pow(2,-10*t)},inOut:function(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}};function P(e,t,s){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:tr,o=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,l="velocity_"+t;if(e.__damp===void 0&&(e.__damp={}),e.__damp[l]===void 0&&(e.__damp[l]=0),Math.abs(e[t]-s)<=o)return e[t]=s,!1;r=Math.max(1e-4,r);var c=2/r,h=a(c*n),u=e[t]-s,f=s,d=i*r;u=Math.min(Math.max(u,-d),d),s=e[t]-u;var A=(e.__damp[l]+c*u)*n;e.__damp[l]=(e.__damp[l]-c*A)*h;var p=s+(u+A)*h;return f-e[t]>0==p>f&&(p=f,e.__damp[l]=(p-f)/n),e[t]=p,!0}var Kn=function(t){return t&&t.isCamera},zn=function(t){return t&&t.isLight},we=new U,Wt=new Me,Zt=new Me,He=new pe,dt=new U;function Qn(e,t,s,r,n,i,a){typeof t=="number"?we.setScalar(t):Array.isArray(t)?we.set(t[0],t[1],t[2]):we.copy(t);var o=e.parent;e.updateWorldMatrix(!0,!1),dt.setFromMatrixPosition(e.matrixWorld),Kn(e)||zn(e)?He.lookAt(dt,we,e.up):He.lookAt(we,dt,e.up),st(e.quaternion,Zt.setFromRotationMatrix(He),s,r,n,i,a),o&&(He.extractRotation(o.matrixWorld),Wt.setFromRotationMatrix(He),st(e.quaternion,Zt.copy(e.quaternion).premultiply(Wt.invert()),s,r,n,i,a))}function Se(e,t,s,r,n,i,a,o){return P(e,t,e[t]+In(e[t],s),r,n,i,a,o)}var _e=new y,qt,$t;function jn(e,t,s,r,n,i,a){return typeof t=="number"?_e.setScalar(t):Array.isArray(t)?_e.set(t[0],t[1]):_e.copy(t),qt=P(e,"x",_e.x,s,r,n,i,a),$t=P(e,"y",_e.y,s,r,n,i,a),qt||$t}var Te=new U,es,ts,ss;function Dt(e,t,s,r,n,i,a){return typeof t=="number"?Te.setScalar(t):Array.isArray(t)?Te.set(t[0],t[1],t[2]):Te.copy(t),es=P(e,"x",Te.x,s,r,n,i,a),ts=P(e,"y",Te.y,s,r,n,i,a),ss=P(e,"z",Te.z,s,r,n,i,a),es||ts||ss}var ge=new me,rs,ns,is,as;function Xn(e,t,s,r,n,i,a){return typeof t=="number"?ge.setScalar(t):Array.isArray(t)?ge.set(t[0],t[1],t[2],t[3]):ge.copy(t),rs=P(e,"x",ge.x,s,r,n,i,a),ns=P(e,"y",ge.y,s,r,n,i,a),is=P(e,"z",ge.z,s,r,n,i,a),as=P(e,"w",ge.w,s,r,n,i,a),rs||ns||is||as}var Ue=new Fr,os,ls,cs;function Yn(e,t,s,r,n,i,a){return Array.isArray(t)?Ue.set(t[0],t[1],t[2],t[3]):Ue.copy(t),os=Se(e,"x",Ue.x,s,r,n,i,a),ls=Se(e,"y",Ue.y,s,r,n,i,a),cs=Se(e,"z",Ue.z,s,r,n,i,a),os||ls||cs}var xe=new z,us,hs,fs;function Vn(e,t,s,r,n,i,a){return t instanceof z?xe.copy(t):Array.isArray(t)?xe.setRGB(t[0],t[1],t[2]):xe.set(t),us=P(e,"r",xe.r,s,r,n,i,a),hs=P(e,"g",xe.g,s,r,n,i,a),fs=P(e,"b",xe.b,s,r,n,i,a),us||hs||fs}var $=new Me,ne=new me,ds=new me,Pe=new me,As,ps,ms,Bs;function st(e,t,s,r,n,i,a){var o=e;Array.isArray(t)?$.set(t[0],t[1],t[2],t[3]):$.copy(t);var l=e.dot($)>0?1:-1;return $.x*=l,$.y*=l,$.z*=l,$.w*=l,As=P(e,"x",$.x,s,r,n,i,a),ps=P(e,"y",$.y,s,r,n,i,a),ms=P(e,"z",$.z,s,r,n,i,a),Bs=P(e,"w",$.w,s,r,n,i,a),ne.set(e.x,e.y,e.z,e.w).normalize(),ds.set(o.__damp.velocity_x,o.__damp.velocity_y,o.__damp.velocity_z,o.__damp.velocity_w),Pe.copy(ne).multiplyScalar(ds.dot(ne)/ne.dot(ne)),o.__damp.velocity_x-=Pe.x,o.__damp.velocity_y-=Pe.y,o.__damp.velocity_z-=Pe.z,o.__damp.velocity_w-=Pe.w,e.set(ne.x,ne.y,ne.z,ne.w),As||ps||ms||Bs}var Le=new Rr,vs,gs,Cs;function Wn(e,t,s,r,n,i,a){return Array.isArray(t)?Le.set(t[0],t[1],t[2]):Le.copy(t),vs=P(e,"radius",Le.radius,s,r,n,i,a),gs=Se(e,"phi",Le.phi,s,r,n,i,a),Cs=Se(e,"theta",Le.theta,s,r,n,i,a),vs||gs||Cs}var Ze=new pe,Es=new U,Ms=new Me,Ts=new U,xs,Rs,Fs;function Zn(e,t,s,r,n,i,a){var o=e;return o.__damp===void 0&&(o.__damp={position:new U,rotation:new Me,scale:new U},e.decompose(o.__damp.position,o.__damp.rotation,o.__damp.scale)),Array.isArray(t)?Ze.set.apply(Ze,Dn(t)):Ze.copy(t),Ze.decompose(Es,Ms,Ts),xs=Dt(o.__damp.position,Es,s,r,n,i,a),Rs=st(o.__damp.rotation,Ms,s,r,n,i,a),Fs=Dt(o.__damp.scale,Ts,s,r,n,i,a),e.compose(o.__damp.position,o.__damp.rotation,o.__damp.scale),xs||Rs||Fs}var qn=Object.freeze({__proto__:null,rsqw:_n,exp:tr,linear:Un,sine:Pn,cubic:Ln,quint:On,circ:Nn,quart:Jn,expo:kn,damp:P,dampLookAt:Qn,dampAngle:Se,damp2:jn,damp3:Dt,damp4:Xn,dampE:Yn,dampC:Vn,dampQ:st,dampS:Wn,dampM:Zn});const $n=parseInt(nt.replace(/\D+/g,""));function Ds(e,t){if(t===Dr)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Mt||t===Ks){let s=e.getIndex();if(s===null){const a=[],o=e.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);e.setIndex(a),s=e.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}const r=s.count-2,n=[];if(s)if(t===Mt)for(let a=1;a<=r;a++)n.push(s.getX(0)),n.push(s.getX(a)),n.push(s.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(n.push(s.getX(a)),n.push(s.getX(a+1)),n.push(s.getX(a+2))):(n.push(s.getX(a+2)),n.push(s.getX(a+1)),n.push(s.getX(a)));n.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(n),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function rt(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);try{return decodeURIComponent(escape(t))}catch{return t}}const Ee="srgb",oe="srgb-linear",Ss=3001,ei=3e3;class Ot extends zs{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new ii(s)}),this.register(function(s){return new ai(s)}),this.register(function(s){return new pi(s)}),this.register(function(s){return new mi(s)}),this.register(function(s){return new Bi(s)}),this.register(function(s){return new li(s)}),this.register(function(s){return new ci(s)}),this.register(function(s){return new ui(s)}),this.register(function(s){return new hi(s)}),this.register(function(s){return new ni(s)}),this.register(function(s){return new fi(s)}),this.register(function(s){return new oi(s)}),this.register(function(s){return new Ai(s)}),this.register(function(s){return new di(s)}),this.register(function(s){return new si(s)}),this.register(function(s){return new vi(s)}),this.register(function(s){return new gi(s)})}load(t,s,r,n){const i=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=Ke.extractUrlBase(t);a=Ke.resolveURL(c,this.path)}else a=Ke.extractUrlBase(t);this.manager.itemStart(t);const o=function(c){n?n(c):console.error(c),i.manager.itemError(t),i.manager.itemEnd(t)},l=new tt(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(c){try{i.parse(c,a,function(h){s(h),i.manager.itemEnd(t)},o)}catch(h){o(h)}},r,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,s,r,n){let i;const a={},o={};if(typeof t=="string")i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(rt(new Uint8Array(t.slice(0,4)))===sr){try{a[x.KHR_BINARY_GLTF]=new Ci(t)}catch(h){n&&n(h);return}i=JSON.parse(a[x.KHR_BINARY_GLTF].content)}else i=JSON.parse(rt(new Uint8Array(t)));else i=t;if(i.asset===void 0||i.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new wi(i,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](l);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[h.name]=h,a[h.name]=!0}if(i.extensionsUsed)for(let c=0;c<i.extensionsUsed.length;++c){const h=i.extensionsUsed[c],u=i.extensionsRequired||[];switch(h){case x.KHR_MATERIALS_UNLIT:a[h]=new ri;break;case x.KHR_DRACO_MESH_COMPRESSION:a[h]=new Ei(i,this.dracoLoader);break;case x.KHR_TEXTURE_TRANSFORM:a[h]=new Mi;break;case x.KHR_MESH_QUANTIZATION:a[h]=new Ti;break;default:u.indexOf(h)>=0&&o[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(r,n)}parseAsync(t,s){const r=this;return new Promise(function(n,i){r.parse(t,s,n,i)})}}function ti(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const x={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class si{constructor(t){this.parser=t,this.name=x.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,s=this.parser.json.nodes||[];for(let r=0,n=s.length;r<n;r++){const i=s[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const s=this.parser,r="light:"+t;let n=s.cache.get(r);if(n)return n;const i=s.json,l=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t];let c;const h=new z(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],oe);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new Ir(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new br(h),c.distance=u;break;case"spot":c=new Sr(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,ie(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=s.createUniqueName(l.name||"light_"+t),n=Promise.resolve(c),s.cache.add(r,n),n}getDependency(t,s){if(t==="light")return this._loadLight(s)}createNodeAttachment(t){const s=this,r=this.parser,i=r.json.nodes[t],o=(i.extensions&&i.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return r._getNodeRef(s.cache,o,l)})}}class ri{constructor(){this.name=x.KHR_MATERIALS_UNLIT}getMaterialType(){return Fe}extendParams(t,s,r){const n=[];t.color=new z(1,1,1),t.opacity=1;const i=s.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const a=i.baseColorFactor;t.color.setRGB(a[0],a[1],a[2],oe),t.opacity=a[3]}i.baseColorTexture!==void 0&&n.push(r.assignTexture(t,"map",i.baseColorTexture,Ee))}return Promise.all(n)}}class ni{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,s){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(s.emissiveIntensity=i),Promise.resolve()}}class ii{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];if(a.clearcoatFactor!==void 0&&(s.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&i.push(r.assignTexture(s,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&i.push(r.assignTexture(s,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(i.push(r.assignTexture(s,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new y(o,o)}return Promise.all(i)}}class ai{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_DISPERSION}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return s.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class oi{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];return a.iridescenceFactor!==void 0&&(s.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&i.push(r.assignTexture(s,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(s.iridescenceIOR=a.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&i.push(r.assignTexture(s,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(i)}}class li{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_SHEEN}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];s.sheenColor=new z(0,0,0),s.sheenRoughness=0,s.sheen=1;const a=n.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;s.sheenColor.setRGB(o[0],o[1],o[2],oe)}return a.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&i.push(r.assignTexture(s,"sheenColorMap",a.sheenColorTexture,Ee)),a.sheenRoughnessTexture!==void 0&&i.push(r.assignTexture(s,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class ci{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];return a.transmissionFactor!==void 0&&(s.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&i.push(r.assignTexture(s,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class ui{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_VOLUME}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];s.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&i.push(r.assignTexture(s,"thicknessMap",a.thicknessTexture)),s.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return s.attenuationColor=new z().setRGB(o[0],o[1],o[2],oe),Promise.all(i)}}class hi{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_IOR}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return s.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class fi{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_SPECULAR}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];s.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&i.push(r.assignTexture(s,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return s.specularColor=new z().setRGB(o[0],o[1],o[2],oe),a.specularColorTexture!==void 0&&i.push(r.assignTexture(s,"specularColorMap",a.specularColorTexture,Ee)),Promise.all(i)}}class di{constructor(t){this.parser=t,this.name=x.EXT_MATERIALS_BUMP}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];return s.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&i.push(r.assignTexture(s,"bumpMap",a.bumpTexture)),Promise.all(i)}}class Ai{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:re}extendMaterialParams(t,s){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];return a.anisotropyStrength!==void 0&&(s.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(s.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&i.push(r.assignTexture(s,"anisotropyMap",a.anisotropyTexture)),Promise.all(i)}}class pi{constructor(t){this.parser=t,this.name=x.KHR_TEXTURE_BASISU}loadTexture(t){const s=this.parser,r=s.json,n=r.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],a=s.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(t,i.source,a)}}class mi{constructor(t){this.parser=t,this.name=x.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const s=this.name,r=this.parser,n=r.json,i=n.textures[t];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],o=n.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(t,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(s)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const s=new Image;s.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",s.onload=s.onerror=function(){t(s.height===1)}})),this.isSupported}}class Bi{constructor(t){this.parser=t,this.name=x.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const s=this.name,r=this.parser,n=r.json,i=n.textures[t];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],o=n.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(t,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(s)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const s=new Image;s.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",s.onload=s.onerror=function(){t(s.height===1)}})),this.isSupported}}class vi{constructor(t){this.name=x.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const s=this.parser.json,r=s.bufferViews[t];if(r.extensions&&r.extensions[this.name]){const n=r.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(o){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,u=n.byteStride,f=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,u,f,n.mode,n.filter).then(function(d){return d.buffer}):a.ready.then(function(){const d=new ArrayBuffer(h*u);return a.decodeGltfBuffer(new Uint8Array(d),h,u,f,n.mode,n.filter),d})})}else return null}}class gi{constructor(t){this.name=x.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const s=this.parser.json,r=s.nodes[t];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const n=s.meshes[r.mesh];for(const c of n.primitives)if(c.mode!==W.TRIANGLES&&c.mode!==W.TRIANGLE_STRIP&&c.mode!==W.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=r.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(h=>(l[c]=h,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],f=c[0].count,d=[];for(const A of u){const p=new pe,B=new U,m=new Me,v=new U(1,1,1),g=new yr(A.geometry,A.material,f);for(let M=0;M<f;M++)l.TRANSLATION&&B.fromBufferAttribute(l.TRANSLATION,M),l.ROTATION&&m.fromBufferAttribute(l.ROTATION,M),l.SCALE&&v.fromBufferAttribute(l.SCALE,M),g.setMatrixAt(M,p.compose(B,m,v));for(const M in l)if(M==="_COLOR_0"){const D=l[M];g.instanceColor=new Gr(D.array,D.itemSize,D.normalized)}else M!=="TRANSLATION"&&M!=="ROTATION"&&M!=="SCALE"&&A.geometry.setAttribute(M,l[M]);Qs.prototype.copy.call(g,A),this.parser.assignFinalMaterial(g),d.push(g)}return h.isGroup?(h.clear(),h.add(...d),h):d[0]}))}}const sr="glTF",Oe=12,bs={JSON:1313821514,BIN:5130562};class Ci{constructor(t){this.name=x.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(t,0,Oe);if(this.header={magic:rt(new Uint8Array(t.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==sr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Oe,n=new DataView(t,Oe);let i=0;for(;i<r;){const a=n.getUint32(i,!0);i+=4;const o=n.getUint32(i,!0);if(i+=4,o===bs.JSON){const l=new Uint8Array(t,Oe+i,a);this.content=rt(l)}else if(o===bs.BIN){const l=Oe+i;this.body=t.slice(l,l+a)}i+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ei{constructor(t,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=x.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(t,s){const r=this.json,n=this.dracoLoader,i=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,o={},l={},c={};for(const h in a){const u=St[h]||h.toLowerCase();o[u]=a[h]}for(const h in t.attributes){const u=St[h]||h.toLowerCase();if(a[h]!==void 0){const f=r.accessors[t.attributes[h]],d=be[f.componentType];c[u]=d.name,l[u]=f.normalized===!0}}return s.getDependency("bufferView",i).then(function(h){return new Promise(function(u,f){n.decodeDracoFile(h,function(d){for(const A in d.attributes){const p=d.attributes[A],B=l[A];B!==void 0&&(p.normalized=B)}u(d)},o,c,oe,f)})})}}class Mi{constructor(){this.name=x.KHR_TEXTURE_TRANSFORM}extendTexture(t,s){return(s.texCoord===void 0||s.texCoord===t.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(t=t.clone(),s.texCoord!==void 0&&(t.channel=s.texCoord),s.offset!==void 0&&t.offset.fromArray(s.offset),s.rotation!==void 0&&(t.rotation=s.rotation),s.scale!==void 0&&t.repeat.fromArray(s.scale),t.needsUpdate=!0),t}}class Ti{constructor(){this.name=x.KHR_MESH_QUANTIZATION}}class rr extends tn{constructor(t,s,r,n){super(t,s,r,n)}copySampleValue_(t){const s=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n*3+n;for(let a=0;a!==n;a++)s[a]=r[i+a];return s}interpolate_(t,s,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,h=n-s,u=(r-s)/h,f=u*u,d=f*u,A=t*c,p=A-c,B=-2*d+3*f,m=d-f,v=1-B,g=m-f+u;for(let M=0;M!==o;M++){const D=a[p+M+o],G=a[p+M+l]*h,w=a[A+M+o],b=a[A+M]*h;i[M]=v*D+g*G+B*w+m*b}return i}}const xi=new Me;class Ri extends rr{interpolate_(t,s,r,n){const i=super.interpolate_(t,s,r,n);return xi.fromArray(i).normalize().toArray(i),i}}const W={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},be={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Is={9728:Ye,9729:te,9984:Pr,9985:Ur,9986:_r,9987:js},ys={33071:Or,33648:Lr,10497:Tt},At={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},St={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...$n>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Fi={CUBICSPLINE:void 0,LINEAR:Xs,STEP:$r},pt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Di(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new wt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:_t})),e.DefaultMaterial}function Ce(e,t,s){for(const r in s.extensions)e[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=s.extensions[r])}function ie(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Si(e,t,s){let r=!1,n=!1,i=!1;for(let c=0,h=t.length;c<h;c++){const u=t[c];if(u.POSITION!==void 0&&(r=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(i=!0),r&&n&&i)break}if(!r&&!n&&!i)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,h=t.length;c<h;c++){const u=t[c];if(r){const f=u.POSITION!==void 0?s.getDependency("accessor",u.POSITION):e.attributes.position;a.push(f)}if(n){const f=u.NORMAL!==void 0?s.getDependency("accessor",u.NORMAL):e.attributes.normal;o.push(f)}if(i){const f=u.COLOR_0!==void 0?s.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(f)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],f=c[2];return r&&(e.morphAttributes.position=h),n&&(e.morphAttributes.normal=u),i&&(e.morphAttributes.color=f),e.morphTargetsRelative=!0,e})}function bi(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(let s=0,r=t.weights.length;s<r;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let r=0,n=s.length;r<n;r++)e.morphTargetDictionary[s[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ii(e){let t;const s=e.extensions&&e.extensions[x.KHR_DRACO_MESH_COMPRESSION];if(s?t="draco:"+s.bufferView+":"+s.indices+":"+mt(s.attributes):t=e.indices+":"+mt(e.attributes)+":"+e.mode,e.targets!==void 0)for(let r=0,n=e.targets.length;r<n;r++)t+=":"+mt(e.targets[r]);return t}function mt(e){let t="";const s=Object.keys(e).sort();for(let r=0,n=s.length;r<n;r++)t+=s[r]+":"+e[s[r]]+";";return t}function bt(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function yi(e){return e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0?"image/jpeg":e.search(/\.webp($|\?)/i)>0||e.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Gi=new pe;class wi{constructor(t={},s={}){this.json=t,this.extensions={},this.plugins={},this.options=s,this.cache=new ti,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,n=!1,i=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||n&&i<98?this.textureLoader=new it(this.options.manager):this.textureLoader=new wr(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new tt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,s){const r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const o={scene:a[0][n.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:n.asset,parser:r,userData:{}};return Ce(i,o,n),ie(o,n),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();t(o)})}).catch(s)}_markDefs(){const t=this.json.nodes||[],s=this.json.skins||[],r=this.json.meshes||[];for(let n=0,i=s.length;n<i;n++){const a=s[n].joints;for(let o=0,l=a.length;o<l;o++)t[a[o]].isBone=!0}for(let n=0,i=t.length;n<i;n++){const a=t[n];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(t,s){s!==void 0&&(t.refs[s]===void 0&&(t.refs[s]=t.uses[s]=0),t.refs[s]++)}_getNodeRef(t,s,r){if(t.refs[s]<=1)return r;const n=r.clone(),i=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,h]of a.children.entries())i(h,o.children[c])};return i(r,n),n.name+="_instance_"+t.uses[s]++,n}_invokeOne(t){const s=Object.values(this.plugins);s.push(this);for(let r=0;r<s.length;r++){const n=t(s[r]);if(n)return n}return null}_invokeAll(t){const s=Object.values(this.plugins);s.unshift(this);const r=[];for(let n=0;n<s.length;n++){const i=t(s[n]);i&&r.push(i)}return r}getDependency(t,s){const r=t+":"+s;let n=this.cache.get(r);if(!n){switch(t){case"scene":n=this.loadScene(s);break;case"node":n=this._invokeOne(function(i){return i.loadNode&&i.loadNode(s)});break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(s)});break;case"accessor":n=this.loadAccessor(s);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(s)});break;case"buffer":n=this.loadBuffer(s);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(s)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(s)});break;case"skin":n=this.loadSkin(s);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(s)});break;case"camera":n=this.loadCamera(s);break;default:if(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(t,s)}),!n)throw new Error("Unknown type: "+t);break}this.cache.add(r,n)}return n}getDependencies(t){let s=this.cache.get(t);if(!s){const r=this,n=this.json[t+(t==="mesh"?"es":"s")]||[];s=Promise.all(n.map(function(i,a){return r.getDependency(t,a)})),this.cache.add(t,s)}return s}loadBuffer(t){const s=this.json.buffers[t],r=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&t===0)return Promise.resolve(this.extensions[x.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,a){r.load(Ke.resolveURL(s.uri,n.path),i,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(t){const s=this.json.bufferViews[t];return this.getDependency("buffer",s.buffer).then(function(r){const n=s.byteLength||0,i=s.byteOffset||0;return r.slice(i,i+n)})}loadAccessor(t){const s=this,r=this.json,n=this.json.accessors[t];if(n.bufferView===void 0&&n.sparse===void 0){const a=At[n.type],o=be[n.componentType],l=n.normalized===!0,c=new o(n.count*a);return Promise.resolve(new ae(c,a,l))}const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(a){const o=a[0],l=At[n.type],c=be[n.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,f=n.byteOffset||0,d=n.bufferView!==void 0?r.bufferViews[n.bufferView].byteStride:void 0,A=n.normalized===!0;let p,B;if(d&&d!==u){const m=Math.floor(f/d),v="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+m+":"+n.count;let g=s.cache.get(v);g||(p=new c(o,m*d,n.count*d/h),g=new Hr(p,d/h),s.cache.add(v,g)),B=new en(g,l,f%d/h,A)}else o===null?p=new c(n.count*l):p=new c(o,f,n.count*l),B=new ae(p,l,A);if(n.sparse!==void 0){const m=At.SCALAR,v=be[n.sparse.indices.componentType],g=n.sparse.indices.byteOffset||0,M=n.sparse.values.byteOffset||0,D=new v(a[1],g,n.sparse.count*m),G=new c(a[2],M,n.sparse.count*l);o!==null&&(B=new ae(B.array.slice(),B.itemSize,B.normalized));for(let w=0,b=D.length;w<b;w++){const I=D[w];if(B.setX(I,G[w*l]),l>=2&&B.setY(I,G[w*l+1]),l>=3&&B.setZ(I,G[w*l+2]),l>=4&&B.setW(I,G[w*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return B})}loadTexture(t){const s=this.json,r=this.options,i=s.textures[t].source,a=s.images[i];let o=this.textureLoader;if(a.uri){const l=r.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(t,i,o)}loadTextureImage(t,s,r){const n=this,i=this.json,a=i.textures[t],o=i.images[s],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(s,r).then(function(h){h.flipY=!1,h.name=a.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const f=(i.samplers||{})[a.sampler]||{};return h.magFilter=Is[f.magFilter]||te,h.minFilter=Is[f.minFilter]||js,h.wrapS=ys[f.wrapS]||Tt,h.wrapT=ys[f.wrapT]||Tt,n.associations.set(h,{textures:t}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(t,s){const r=this,n=this.json,i=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(u=>u.clone());const a=n.images[t],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=r.getDependency("bufferView",a.bufferView).then(function(u){c=!0;const f=new Blob([u],{type:a.mimeType});return l=o.createObjectURL(f),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(f,d){let A=f;s.isImageBitmapLoader===!0&&(A=function(p){const B=new Ie(p);B.needsUpdate=!0,f(B)}),s.load(Ke.resolveURL(u,i.path),A,void 0,d)})}).then(function(u){return c===!0&&o.revokeObjectURL(l),ie(u,a),u.userData.mimeType=a.mimeType||yi(a.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[t]=h,h}assignTexture(t,s,r,n){const i=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),i.extensions[x.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[x.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=i.associations.get(a);a=i.extensions[x.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),i.associations.set(a,l)}}return n!==void 0&&(typeof n=="number"&&(n=n===Ss?Ee:oe),"colorSpace"in a?a.colorSpace=n:a.encoding=n===Ee?Ss:ei),t[s]=a,a})}assignFinalMaterial(t){const s=t.geometry;let r=t.material;const n=s.attributes.tangent===void 0,i=s.attributes.color!==void 0,a=s.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new Nr,ze.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(o,l)),r=l}else if(t.isLine){const o="LineBasicMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new Jr,ze.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(o,l)),r=l}if(n||i||a){let o="ClonedMaterial:"+r.uuid+":";n&&(o+="derivative-tangents:"),i&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=r.clone(),i&&(l.vertexColors=!0),a&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(r))),r=l}t.material=r}getMaterialType(){return wt}loadMaterial(t){const s=this,r=this.json,n=this.extensions,i=r.materials[t];let a;const o={},l=i.extensions||{},c=[];if(l[x.KHR_MATERIALS_UNLIT]){const u=n[x.KHR_MATERIALS_UNLIT];a=u.getMaterialType(),c.push(u.extendParams(o,i,s))}else{const u=i.pbrMetallicRoughness||{};if(o.color=new z(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;o.color.setRGB(f[0],f[1],f[2],oe),o.opacity=f[3]}u.baseColorTexture!==void 0&&c.push(s.assignTexture(o,"map",u.baseColorTexture,Ee)),o.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,o.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(s.assignTexture(o,"metalnessMap",u.metallicRoughnessTexture)),c.push(s.assignTexture(o,"roughnessMap",u.metallicRoughnessTexture))),a=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(t,o)})))}i.doubleSided===!0&&(o.side=Je);const h=i.alphaMode||pt.OPAQUE;if(h===pt.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===pt.MASK&&(o.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&a!==Fe&&(c.push(s.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new y(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;o.normalScale.set(u,u)}if(i.occlusionTexture!==void 0&&a!==Fe&&(c.push(s.assignTexture(o,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&a!==Fe){const u=i.emissiveFactor;o.emissive=new z().setRGB(u[0],u[1],u[2],oe)}return i.emissiveTexture!==void 0&&a!==Fe&&c.push(s.assignTexture(o,"emissiveMap",i.emissiveTexture,Ee)),Promise.all(c).then(function(){const u=new a(o);return i.name&&(u.name=i.name),ie(u,i),s.associations.set(u,{materials:t}),i.extensions&&Ce(n,u,i),u})}createUniqueName(t){const s=kr.sanitizeNodeName(t||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(t){const s=this,r=this.extensions,n=this.primitiveCache;function i(o){return r[x.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,s).then(function(l){return Gs(l,o,s)})}const a=[];for(let o=0,l=t.length;o<l;o++){const c=t[o],h=Ii(c),u=n[h];if(u)a.push(u.promise);else{let f;c.extensions&&c.extensions[x.KHR_DRACO_MESH_COMPRESSION]?f=i(c):f=Gs(new at,c,s),n[h]={primitive:c,promise:f},a.push(f)}}return Promise.all(a)}loadMesh(t){const s=this,r=this.json,n=this.extensions,i=r.meshes[t],a=i.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const h=a[l].material===void 0?Di(this.cache):this.getDependency("material",a[l].material);o.push(h)}return o.push(s.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let d=0,A=h.length;d<A;d++){const p=h[d],B=a[d];let m;const v=c[d];if(B.mode===W.TRIANGLES||B.mode===W.TRIANGLE_STRIP||B.mode===W.TRIANGLE_FAN||B.mode===void 0)m=i.isSkinnedMesh===!0?new Kr(p,v):new Ht(p,v),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),B.mode===W.TRIANGLE_STRIP?m.geometry=Ds(m.geometry,Ks):B.mode===W.TRIANGLE_FAN&&(m.geometry=Ds(m.geometry,Mt));else if(B.mode===W.LINES)m=new zr(p,v);else if(B.mode===W.LINE_STRIP)m=new Qr(p,v);else if(B.mode===W.LINE_LOOP)m=new jr(p,v);else if(B.mode===W.POINTS)m=new Xr(p,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+B.mode);Object.keys(m.geometry.morphAttributes).length>0&&bi(m,i),m.name=s.createUniqueName(i.name||"mesh_"+t),ie(m,i),B.extensions&&Ce(n,m,B),s.assignFinalMaterial(m),u.push(m)}for(let d=0,A=u.length;d<A;d++)s.associations.set(u[d],{meshes:t,primitives:d});if(u.length===1)return i.extensions&&Ce(n,u[0],i),u[0];const f=new ft;i.extensions&&Ce(n,f,i),s.associations.set(f,{meshes:t});for(let d=0,A=u.length;d<A;d++)f.add(u[d]);return f})}loadCamera(t){let s;const r=this.json.cameras[t],n=r[r.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?s=new ot(Yr.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):r.type==="orthographic"&&(s=new Vr(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(s.name=this.createUniqueName(r.name)),ie(s,r),Promise.resolve(s)}loadSkin(t){const s=this.json.skins[t],r=[];for(let n=0,i=s.joints.length;n<i;n++)r.push(this._loadNodeShallow(s.joints[n]));return s.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",s.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(n){const i=n.pop(),a=n,o=[],l=[];for(let c=0,h=a.length;c<h;c++){const u=a[c];if(u){o.push(u);const f=new pe;i!==null&&f.fromArray(i.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[c])}return new Wr(o,l)})}loadAnimation(t){const s=this.json,r=this,n=s.animations[t],i=n.name?n.name:"animation_"+t,a=[],o=[],l=[],c=[],h=[];for(let u=0,f=n.channels.length;u<f;u++){const d=n.channels[u],A=n.samplers[d.sampler],p=d.target,B=p.node,m=n.parameters!==void 0?n.parameters[A.input]:A.input,v=n.parameters!==void 0?n.parameters[A.output]:A.output;p.node!==void 0&&(a.push(this.getDependency("node",B)),o.push(this.getDependency("accessor",m)),l.push(this.getDependency("accessor",v)),c.push(A),h.push(p))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const f=u[0],d=u[1],A=u[2],p=u[3],B=u[4],m=[];for(let v=0,g=f.length;v<g;v++){const M=f[v],D=d[v],G=A[v],w=p[v],b=B[v];if(M===void 0)continue;M.updateMatrix&&M.updateMatrix();const I=r._createAnimationTracks(M,D,G,w,b);if(I)for(let F=0;F<I.length;F++)m.push(I[F])}return new Zr(i,void 0,m)})}createNodeMesh(t){const s=this.json,r=this,n=s.nodes[t];return n.mesh===void 0?null:r.getDependency("mesh",n.mesh).then(function(i){const a=r._getNodeRef(r.meshCache,n.mesh,i);return n.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=n.weights.length;l<c;l++)o.morphTargetInfluences[l]=n.weights[l]}),a})}loadNode(t){const s=this.json,r=this,n=s.nodes[t],i=r._loadNodeShallow(t),a=[],o=n.children||[];for(let c=0,h=o.length;c<h;c++)a.push(r.getDependency("node",o[c]));const l=n.skin===void 0?Promise.resolve(null):r.getDependency("skin",n.skin);return Promise.all([i,Promise.all(a),l]).then(function(c){const h=c[0],u=c[1],f=c[2];f!==null&&h.traverse(function(d){d.isSkinnedMesh&&d.bind(f,Gi)});for(let d=0,A=u.length;d<A;d++)h.add(u[d]);return h})}_loadNodeShallow(t){const s=this.json,r=this.extensions,n=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const i=s.nodes[t],a=i.name?n.createUniqueName(i.name):"",o=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(t)});return l&&o.push(l),i.camera!==void 0&&o.push(n.getDependency("camera",i.camera).then(function(c){return n._getNodeRef(n.cameraCache,i.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(t)}).forEach(function(c){o.push(c)}),this.nodeCache[t]=Promise.all(o).then(function(c){let h;if(i.isBone===!0?h=new qr:c.length>1?h=new ft:c.length===1?h=c[0]:h=new Qs,h!==c[0])for(let u=0,f=c.length;u<f;u++)h.add(c[u]);if(i.name&&(h.userData.name=i.name,h.name=a),ie(h,i),i.extensions&&Ce(r,h,i),i.matrix!==void 0){const u=new pe;u.fromArray(i.matrix),h.applyMatrix4(u)}else i.translation!==void 0&&h.position.fromArray(i.translation),i.rotation!==void 0&&h.quaternion.fromArray(i.rotation),i.scale!==void 0&&h.scale.fromArray(i.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=t,h}),this.nodeCache[t]}loadScene(t){const s=this.extensions,r=this.json.scenes[t],n=this,i=new ft;r.name&&(i.name=n.createUniqueName(r.name)),ie(i,r),r.extensions&&Ce(s,i,r);const a=r.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(n.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let h=0,u=l.length;h<u;h++)i.add(l[h]);const c=h=>{const u=new Map;for(const[f,d]of n.associations)(f instanceof ze||f instanceof Ie)&&u.set(f,d);return h.traverse(f=>{const d=n.associations.get(f);d!=null&&u.set(f,d)}),u};return n.associations=c(i),i})}_createAnimationTracks(t,s,r,n,i){const a=[],o=t.name?t.name:t.uuid,l=[];fe[i.path]===fe.weights?t.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(o);let c;switch(fe[i.path]){case fe.weights:c=Kt;break;case fe.rotation:c=zt;break;case fe.position:case fe.scale:c=kt;break;default:switch(r.itemSize){case 1:c=Kt;break;case 2:case 3:default:c=kt;break}break}const h=n.interpolation!==void 0?Fi[n.interpolation]:Xs,u=this._getArrayFromAccessor(r);for(let f=0,d=l.length;f<d;f++){const A=new c(l[f]+"."+fe[i.path],s.array,u,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(A),a.push(A)}return a}_getArrayFromAccessor(t){let s=t.array;if(t.normalized){const r=bt(s.constructor),n=new Float32Array(s.length);for(let i=0,a=s.length;i<a;i++)n[i]=s[i]*r;s=n}return s}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(r){const n=this instanceof zt?Ri:rr;return new n(this.times,this.values,this.getValueSize()/3,r)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Hi(e,t,s){const r=t.attributes,n=new sn;if(r.POSITION!==void 0){const o=s.json.accessors[r.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(n.set(new U(l[0],l[1],l[2]),new U(c[0],c[1],c[2])),o.normalized){const h=bt(be[o.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=t.targets;if(i!==void 0){const o=new U,l=new U;for(let c=0,h=i.length;c<h;c++){const u=i[c];if(u.POSITION!==void 0){const f=s.json.accessors[u.POSITION],d=f.min,A=f.max;if(d!==void 0&&A!==void 0){if(l.setX(Math.max(Math.abs(d[0]),Math.abs(A[0]))),l.setY(Math.max(Math.abs(d[1]),Math.abs(A[1]))),l.setZ(Math.max(Math.abs(d[2]),Math.abs(A[2]))),f.normalized){const p=bt(be[f.componentType]);l.multiplyScalar(p)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(o)}e.boundingBox=n;const a=new rn;n.getCenter(a.center),a.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=a}function Gs(e,t,s){const r=t.attributes,n=[];function i(a,o){return s.getDependency("accessor",a).then(function(l){e.setAttribute(o,l)})}for(const a in r){const o=St[a]||a.toLowerCase();o in e.attributes||n.push(i(r[a],o))}if(t.indices!==void 0&&!e.index){const a=s.getDependency("accessor",t.indices).then(function(o){e.setIndex(o)});n.push(a)}return ie(e,t),Hi(e,t,s),Promise.all(n).then(function(){return t.targets!==void 0?Si(e,t.targets,s):e})}const Bt=new WeakMap;class _i extends zs{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,s,r,n){const i=new tt(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(s).catch(n)},r,n)}decodeDracoFile(t,s,r,n){const i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(t,i).then(s)}decodeGeometry(t,s){for(const l in s.attributeTypes){const c=s.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(s.attributeTypes[l]=c.name)}const r=JSON.stringify(s);if(Bt.has(t)){const l=Bt.get(t);if(l.key===r)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const i=this.workerNextTaskID++,a=t.byteLength,o=this._getWorker(i,a).then(l=>(n=l,new Promise((c,h)=>{n._callbacks[i]={resolve:c,reject:h},n.postMessage({type:"decode",id:i,taskConfig:s,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{n&&i&&this._releaseTask(n,i)}),Bt.set(t,{key:r,promise:o}),o}_createGeometry(t){const s=new at;t.index&&s.setIndex(new ae(t.index.array,1));for(let r=0;r<t.attributes.length;r++){const n=t.attributes[r],i=n.name,a=n.array,o=n.itemSize;s.setAttribute(i,new ae(a,o))}return s}_loadLibrary(t,s){const r=new tt(this.manager);return r.setPath(this.decoderPath),r.setResponseType(s),r.setWithCredentials(this.withCredentials),new Promise((n,i)=>{r.load(t,n,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",s=[];return t?s.push(this._loadLibrary("draco_decoder.js","text")):(s.push(this._loadLibrary("draco_wasm_wrapper.js","text")),s.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(s).then(r=>{const n=r[0];t||(this.decoderConfig.wasmBinary=r[1]);const i=Ui.toString(),a=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(t,s){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(i){const a=i.data;switch(a.type){case"decode":n._callbacks[a.id].resolve(a);break;case"error":n._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,i){return n._taskLoad>i._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[t]=s,r._taskLoad+=s,r})}_releaseTask(t,s){t._taskLoad-=t._taskCosts[s],delete t._callbacks[s],delete t._taskCosts[s]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function Ui(){let e,t;onmessage=function(a){const o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(h){e.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(e)});break;case"decode":const l=o.buffer,c=o.taskConfig;t.then(h=>{const u=h.draco,f=new u.Decoder,d=new u.DecoderBuffer;d.Init(new Int8Array(l),l.byteLength);try{const A=s(u,f,d,c),p=A.attributes.map(B=>B.array.buffer);A.index&&p.push(A.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:A},p)}catch(A){console.error(A),self.postMessage({type:"error",id:o.id,error:A.message})}finally{u.destroy(d),u.destroy(f)}});break}};function s(a,o,l,c){const h=c.attributeIDs,u=c.attributeTypes;let f,d;const A=o.GetEncodedGeometryType(l);if(A===a.TRIANGULAR_MESH)f=new a.Mesh,d=o.DecodeBufferToMesh(l,f);else if(A===a.POINT_CLOUD)f=new a.PointCloud,d=o.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const p={index:null,attributes:[]};for(const B in h){const m=self[u[B]];let v,g;if(c.useUniqueIDs)g=h[B],v=o.GetAttributeByUniqueId(f,g);else{if(g=o.GetAttributeId(f,a[h[B]]),g===-1)continue;v=o.GetAttribute(f,g)}p.attributes.push(n(a,o,f,B,m,v))}return A===a.TRIANGULAR_MESH&&(p.index=r(a,o,f)),a.destroy(f),p}function r(a,o,l){const h=l.num_faces()*3,u=h*4,f=a._malloc(u);o.GetTrianglesUInt32Array(l,u,f);const d=new Uint32Array(a.HEAPF32.buffer,f,h).slice();return a._free(f),{array:d,itemSize:1}}function n(a,o,l,c,h,u){const f=u.num_components(),A=l.num_points()*f,p=A*h.BYTES_PER_ELEMENT,B=i(a,h),m=a._malloc(p);o.GetAttributeDataArrayForAllPoints(l,u,B,p,m);const v=new h(a.HEAPF32.buffer,m,A).slice();return a._free(m),{name:c,array:v,itemSize:f}}function i(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let qe;const vt=()=>{if(qe)return qe;const e="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",t="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",s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let n=e;WebAssembly.validate(s)&&(n=t);let i;const a=WebAssembly.instantiate(o(n),{}).then(u=>{i=u.instance,i.exports.__wasm_call_ctors()});function o(u){const f=new Uint8Array(u.length);for(let A=0;A<u.length;++A){const p=u.charCodeAt(A);f[A]=p>96?p-71:p>64?p-65:p>47?p+4:p>46?63:62}let d=0;for(let A=0;A<u.length;++A)f[d++]=f[A]<60?r[f[A]]:(f[A]-60)*64+f[++A];return f.buffer.slice(0,d)}function l(u,f,d,A,p,B){const m=i.exports.sbrk,v=d+3&-4,g=m(v*A),M=m(p.length),D=new Uint8Array(i.exports.memory.buffer);D.set(p,M);const G=u(g,d,A,M,p.length);if(G===0&&B&&B(g,v,A),f.set(D.subarray(g,g+d*A)),m(g-m(0)),G!==0)throw new Error(`Malformed buffer data: ${G}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return qe={ready:a,supported:!0,decodeVertexBuffer(u,f,d,A,p){l(i.exports.meshopt_decodeVertexBuffer,u,f,d,A,i.exports[c[p]])},decodeIndexBuffer(u,f,d,A){l(i.exports.meshopt_decodeIndexBuffer,u,f,d,A)},decodeIndexSequence(u,f,d,A){l(i.exports.meshopt_decodeIndexSequence,u,f,d,A)},decodeGltfBuffer(u,f,d,A,p,B){l(i.exports[h[p]],u,f,d,A,i.exports[c[B]])}},qe},gt=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function je(e,t){const s=De(i=>i.gl),r=Ge(it,gt(e)?Object.values(e):e);return E.useLayoutEffect(()=>{t?.(r)},[t]),E.useEffect(()=>{if("initTexture"in s){let i=[];Array.isArray(r)?i=r:r instanceof Ie?i=[r]:gt(r)&&(i=Object.values(r)),i.forEach(a=>{a instanceof Ie&&s.initTexture(a)})}},[s,r]),E.useMemo(()=>{if(gt(e)){const i={};let a=0;for(const o in e)i[o]=r[a++];return i}else return r},[e,r])}je.preload=e=>Ge.preload(it,e);je.clear=e=>Ge.clear(it,e);const Pi=()=>parseInt(nt.replace(/\D+/g,"")),Li=Pi();let $e=null,nr="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function ir(e=!0,t=!0,s){return r=>{s&&s(r),e&&($e||($e=new _i),$e.setDecoderPath(typeof e=="string"?e:nr),r.setDRACOLoader($e)),t&&r.setMeshoptDecoder(typeof vt=="function"?vt():vt)}}const Ve=(e,t,s,r)=>Ge(Ot,e,ir(t,s,r));Ve.preload=(e,t,s,r)=>Ge.preload(Ot,e,ir(t,s,r));Ve.clear=e=>Ge.clear(Ot,e);Ve.setDecoderPath=e=>{nr=e};class Oi extends Z{constructor(t=new y){super({uniforms:{inputBuffer:new C(null),depthBuffer:new C(null),resolution:new C(new y),texelSize:new C(new y),halfTexelSize:new C(new y),kernel:new C(0),scale:new C(1),cameraNear:new C(0),cameraFar:new C(1),minDepthThreshold:new C(0),maxDepthThreshold:new C(1),depthScale:new C(0),depthToBlurRatioBias:new C(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${Li>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:ee,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(t.x,t.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(t,s){this.uniforms.texelSize.value.set(t,s),this.uniforms.halfTexelSize.value.set(t,s).multiplyScalar(.5)}setResolution(t){this.uniforms.resolution.value.copy(t)}}class Ni{constructor({gl:t,resolution:s,width:r=500,height:n=500,minDepthThreshold:i=0,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new j(s,s,{minFilter:te,magFilter:te,stencilBuffer:!1,depthBuffer:!1,type:Ut}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new Oi,this.convolutionMaterial.setTexelSize(1/r,1/n),this.convolutionMaterial.setResolution(new y(r,n)),this.scene=new xt,this.camera=new Ys,this.convolutionMaterial.uniforms.minDepthThreshold.value=i,this.convolutionMaterial.uniforms.maxDepthThreshold.value=a,this.convolutionMaterial.uniforms.depthScale.value=o,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=o>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),h=new Float32Array([0,0,2,0,0,2]),u=new at;u.setAttribute("position",new ae(c,3)),u.setAttribute("uv",new ae(h,2)),this.screen=new Ht(u,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(t,s,r){const n=this.scene,i=this.camera,a=this.renderTargetA,o=this.renderTargetB;let l=this.convolutionMaterial,c=l.uniforms;c.depthBuffer.value=s.depthTexture;const h=l.kernel;let u=s,f,d,A;for(d=0,A=h.length-1;d<A;++d)f=(d&1)===0?a:o,c.kernel.value=h[d],c.inputBuffer.value=u.texture,t.setRenderTarget(f),t.render(n,i),u=f;c.kernel.value=h[d],c.inputBuffer.value=u.texture,t.setRenderTarget(this.renderToScreen?null:r),t.render(n,i)}}let Ji=class extends wt{constructor(t={}){super(t),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(t)}onBeforeCompile(t){var s;(s=t.defines)!=null&&s.USE_UV||(t.defines.USE_UV=""),t.uniforms.hasBlur=this._hasBlur,t.uniforms.tDiffuse=this._tDiffuse,t.uniforms.tDepth=this._tDepth,t.uniforms.distortionMap=this._distortionMap,t.uniforms.tDiffuseBlur=this._tDiffuseBlur,t.uniforms.textureMatrix=this._textureMatrix,t.uniforms.mirror=this._mirror,t.uniforms.mixBlur=this._mixBlur,t.uniforms.mixStrength=this._blurStrength,t.uniforms.minDepthThreshold=this._minDepthThreshold,t.uniforms.maxDepthThreshold=this._maxDepthThreshold,t.uniforms.depthScale=this._depthScale,t.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,t.uniforms.distortion=this._distortion,t.uniforms.mixContrast=this._mixContrast,t.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${t.vertexShader}`,t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),t.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${t.fragmentShader}`,t.fragmentShader=t.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(t){this._tDiffuse.value=t}get tDepth(){return this._tDepth.value}set tDepth(t){this._tDepth.value=t}get distortionMap(){return this._distortionMap.value}set distortionMap(t){this._distortionMap.value=t}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(t){this._tDiffuseBlur.value=t}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(t){this._textureMatrix.value=t}get hasBlur(){return this._hasBlur.value}set hasBlur(t){this._hasBlur.value=t}get mirror(){return this._mirror.value}set mirror(t){this._mirror.value=t}get mixBlur(){return this._mixBlur.value}set mixBlur(t){this._mixBlur.value=t}get mixStrength(){return this._blurStrength.value}set mixStrength(t){this._blurStrength.value=t}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(t){this._minDepthThreshold.value=t}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(t){this._maxDepthThreshold.value=t}get depthScale(){return this._depthScale.value}set depthScale(t){this._depthScale.value=t}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(t){this._depthToBlurRatioBias.value=t}get distortion(){return this._distortion.value}set distortion(t){this._distortion.value=t}get mixContrast(){return this._mixContrast.value}set mixContrast(t){this._mixContrast.value=t}};const ki=E.forwardRef(({mixBlur:e=0,mixStrength:t=1,resolution:s=256,blur:r=[0,0],minDepthThreshold:n=.9,maxDepthThreshold:i=1,depthScale:a=0,depthToBlurRatioBias:o=.25,mirror:l=0,distortion:c=1,mixContrast:h=1,distortionMap:u,reflectorOffset:f=0,...d},A)=>{Gt({MeshReflectorMaterialImpl:Ji});const p=De(({gl:H})=>H),B=De(({camera:H})=>H),m=De(({scene:H})=>H);r=Array.isArray(r)?r:[r,r];const v=r[0]+r[1]>0,g=r[0],M=r[1],D=E.useRef(null);E.useImperativeHandle(A,()=>D.current,[]);const[G]=E.useState(()=>new nn),[w]=E.useState(()=>new U),[b]=E.useState(()=>new U),[I]=E.useState(()=>new U),[F]=E.useState(()=>new pe),[K]=E.useState(()=>new U(0,0,-1)),[O]=E.useState(()=>new me),[q]=E.useState(()=>new U),[le]=E.useState(()=>new U),[X]=E.useState(()=>new me),[ce]=E.useState(()=>new pe),[N]=E.useState(()=>new ot),ct=E.useCallback(()=>{var H;const J=D.current.parent||((H=D.current)==null||(H=H.__r3f.parent)==null?void 0:H.object);if(!J||(b.setFromMatrixPosition(J.matrixWorld),I.setFromMatrixPosition(B.matrixWorld),F.extractRotation(J.matrixWorld),w.set(0,0,1),w.applyMatrix4(F),b.addScaledVector(w,f),q.subVectors(b,I),q.dot(w)>0))return;q.reflect(w).negate(),q.add(b),F.extractRotation(B.matrixWorld),K.set(0,0,-1),K.applyMatrix4(F),K.add(I),le.subVectors(b,K),le.reflect(w).negate(),le.add(b),N.position.copy(q),N.up.set(0,1,0),N.up.applyMatrix4(F),N.up.reflect(w),N.lookAt(le),N.far=B.far,N.updateMatrixWorld(),N.projectionMatrix.copy(B.projectionMatrix),ce.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ce.multiply(N.projectionMatrix),ce.multiply(N.matrixWorldInverse),ce.multiply(J.matrixWorld),G.setFromNormalAndCoplanarPoint(w,b),G.applyMatrix4(N.matrixWorldInverse),O.set(G.normal.x,G.normal.y,G.normal.z,G.constant);const k=N.projectionMatrix;X.x=(Math.sign(O.x)+k.elements[8])/k.elements[0],X.y=(Math.sign(O.y)+k.elements[9])/k.elements[5],X.z=-1,X.w=(1+k.elements[10])/k.elements[14],O.multiplyScalar(2/O.dot(X)),k.elements[2]=O.x,k.elements[6]=O.y,k.elements[10]=O.z+1,k.elements[14]=O.w},[B,f]),[ue,ut,he,ve]=E.useMemo(()=>{const H={minFilter:te,magFilter:te,type:Ut},J=new j(s,s,H);J.depthBuffer=!0,J.depthTexture=new Vs(s,s),J.depthTexture.format=an,J.depthTexture.type=on;const k=new j(s,s,H),ht=new Ni({gl:p,resolution:s,width:g,height:M,minDepthThreshold:n,maxDepthThreshold:i,depthScale:a,depthToBlurRatioBias:o}),dr={mirror:l,textureMatrix:ce,mixBlur:e,tDiffuse:J.texture,tDepth:J.depthTexture,tDiffuseBlur:k.texture,hasBlur:v,mixStrength:t,minDepthThreshold:n,maxDepthThreshold:i,depthScale:a,depthToBlurRatioBias:o,distortion:c,distortionMap:u,mixContrast:h,"defines-USE_BLUR":v?"":void 0,"defines-USE_DEPTH":a>0?"":void 0,"defines-USE_DISTORTION":u?"":void 0};return[J,k,ht,dr]},[p,g,M,ce,s,l,v,e,t,n,i,a,o,c,u,h]);return Pt(()=>{var H;const J=D.current.parent||((H=D.current)==null||(H=H.__r3f.parent)==null?void 0:H.object);if(!J)return;J.visible=!1;const k=p.xr.enabled,ht=p.shadowMap.autoUpdate;ct(),p.xr.enabled=!1,p.shadowMap.autoUpdate=!1,p.setRenderTarget(ue),p.state.buffers.depth.setMask(!0),p.autoClear||p.clear(),p.render(m,N),v&&he.render(p,ue,ut),p.xr.enabled=k,p.shadowMap.autoUpdate=ht,J.visible=!0,p.setRenderTarget(null)}),E.createElement("meshReflectorMaterialImpl",Rt({attach:"material",key:"key"+ve["defines-USE_BLUR"]+ve["defines-USE_DEPTH"]+ve["defines-USE_DISTORTION"],ref:D},ve,d))});/**
 * postprocessing v6.37.8 build Fri Sep 12 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rüschen
 * @license Zlib
 */var Ct=1/1e3,Ki=1e3,zi=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Ct}get fixedDelta(){return this._fixedDelta*Ct}set fixedDelta(e){this._fixedDelta=e*Ki}get elapsed(){return this._elapsed*Ct}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Qi=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),s=new at;return s.setAttribute("position",new ae(e,3)),s.setAttribute("uv",new ae(t,2)),s})(),Q=class It{static get fullscreenGeometry(){return Qi}constructor(t="Pass",s=new xt,r=new Ys){this.name=t,this.renderer=null,this.scene=s,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const s=this.fullscreenMaterial;s!==null&&(s.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let s=this.screen;s!==null?s.material=t:(s=new Ht(It.fullscreenGeometry,t),s.frustumCulled=!1,this.scene===null&&(this.scene=new xt),this.scene.add(s),this.screen=s)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,s=Be){}render(t,s,r,n,i){throw new Error("Render method not implemented!")}setSize(t,s){}initialize(t,s,r){}dispose(){for(const t of Object.keys(this)){const s=this[t];(s instanceof j||s instanceof ze||s instanceof Ie||s instanceof It)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},ji=class extends Q{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,s,r,n){const i=e.state.buffers.stencil;i.setLocked(!1),i.setTest(!1)}},Xi=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,We="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",ar=class extends Z{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new C(null),opacity:new C(1)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Xi,vertexShader:We})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Yi=class extends Q{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new ar,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new j(1,1,{minFilter:te,magFilter:te,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,s,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTarget.texture.type=s,s!==se?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e!==null&&e.outputColorSpace===_&&(this.renderTarget.texture.colorSpace=_))}},ws=new z,or=class extends Q{constructor(e=!0,t=!0,s=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=s,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,s){this.color=e,this.depth=t,this.stencil=s}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,s,r,n){const i=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=i!==null,c=a>=0;l?(e.getClearColor(ws),e.setClearColor(i,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(ws,o):c&&e.setClearAlpha(o)}},Vi=class extends Q{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new or(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,s,r,n){const i=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),a.stencil.setFunc(i.ALWAYS,h,4294967295),a.stencil.setClear(u),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,s))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(s),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(i.EQUAL,1,4294967295),a.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),a.stencil.setLocked(!0)}},Wi=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:s=!1,multisampling:r=0,frameBufferType:n}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,s,n,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Yi,this.depthTexture=null,this.passes=[],this.timer=new zi,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,s=this.multisampling;s>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):s!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new y),s=e.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===se&&e.outputColorSpace===_&&(this.inputBuffer.texture.colorSpace=_,this.outputBuffer.texture.colorSpace=_,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const n of this.passes)n.initialize(e,s,r)}}replaceRenderer(e,t=!0){const s=this.renderer,r=s.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(s.domElement),r.appendChild(e.domElement)),s}createDepthTexture(){const e=this.depthTexture=new Vs;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ln,e.type=cn):e.type=un,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,s,r){const n=this.renderer,i=n===null?new y:n.getDrawingBufferSize(new y),a={minFilter:te,magFilter:te,stencilBuffer:t,depthBuffer:e,type:s},o=new j(i.width,i.height,a);return r>0&&(o.ignoreDepthForMultisampleCopy=!1,o.samples=r),s===se&&n!==null&&n.outputColorSpace===_&&(o.texture.colorSpace=_),o.texture.name="EffectComposer.Buffer",o.texture.generateMipmaps=!1,o}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const s=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new y),i=r.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,i,a),this.autoRenderToScreen&&(s.length>0&&(s[s.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?s.splice(t,0,e):s.push(e),this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const o=this.createDepthTexture();for(e of s)e.setDepthTexture(o)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,s=t.indexOf(e);if(s!==-1&&t.splice(s,1).length>0){if(this.depthTexture!==null){const i=(o,l)=>o||l.needsDepthTexture;t.reduce(i,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&s===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,s=this.copyPass;let r=this.inputBuffer,n=this.outputBuffer,i=!1,a,o,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const c of this.passes)c.enabled&&(c.render(t,r,n,e,i),c.needsSwap&&(i&&(s.renderToScreen=c.renderToScreen,a=t.getContext(),o=t.state.buffers.stencil,o.setFunc(a.NOTEQUAL,1,4294967295),s.render(t,r,n,e,i),o.setFunc(a.EQUAL,1,4294967295)),l=r,r=n,n=l),c instanceof Vi?i=!0:c instanceof ji&&(i=!1))}setSize(e,t,s){const r=this.renderer,n=r.getSize(new y);(e===void 0||t===void 0)&&(e=n.width,t=n.height),(n.width!==e||n.height!==t)&&r.setSize(e,t,s);const i=r.getDrawingBufferSize(new y);this.inputBuffer.setSize(i.width,i.height),this.outputBuffer.setSize(i.width,i.height);for(const a of this.passes)a.setSize(i.width,i.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Q.fullscreenGeometry.dispose()}},Ae={NONE:0,DEPTH:1,CONVOLUTION:2},S={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Zi=class{constructor(){this.shaderParts=new Map([[S.FRAGMENT_HEAD,null],[S.FRAGMENT_MAIN_UV,null],[S.FRAGMENT_MAIN_IMAGE,null],[S.VERTEX_HEAD,null],[S.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ae.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ws}},Et=!1,Hs=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let s;if(t.material.flatShading)switch(t.material.side){case Je:s=this.materialsFlatShadedDoubleSide;break;case ke:s=this.materialsFlatShadedBackSide;break;default:s=this.materialsFlatShaded;break}else switch(t.material.side){case Je:s=this.materialsDoubleSide;break;case ke:s=this.materialsBackSide;break;default:s=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=s[2]:t.isInstancedMesh?t.material=s[1]:t.material=s[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof Z))return e.clone();const t=e.uniforms,s=new Map;for(const n in t){const i=t[n].value;i.isRenderTargetTexture&&(t[n].value=null,s.set(n,i))}const r=e.clone();for(const n of s)t[n[0]].value=n[1],r.uniforms[n[0]].value=n[1];return r}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const s of t)s.uniforms=Object.assign({},e.uniforms),s.side=_t;t[2].skinning=!0,this.materialsBackSide=t.map(s=>{const r=this.cloneMaterial(s);return r.uniforms=Object.assign({},e.uniforms),r.side=ke,r}),this.materialsDoubleSide=t.map(s=>{const r=this.cloneMaterial(s);return r.uniforms=Object.assign({},e.uniforms),r.side=Je,r}),this.materialsFlatShaded=t.map(s=>{const r=this.cloneMaterial(s);return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(s=>{const r=this.cloneMaterial(s);return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=ke,r}),this.materialsFlatShadedDoubleSide=t.map(s=>{const r=this.cloneMaterial(s);return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Je,r})}}render(e,t,s){const r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Et){const n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,s);for(const i of n)i[0].material=i[1];this.meshCount!==n.size&&n.clear()}else{const n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,s),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Et}static set workaroundEnabled(e){Et=e}},de=-1,L=class extends Lt{constructor(e,t=de,s=de,r=1){super(),this.resizable=e,this.baseSize=new y(1,1),this.preferredSize=new y(t,s),this.target=this.preferredSize,this.s=r,this.effectiveSize=new y,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,s=this.effectiveSize,r=this.scale;t.width!==de?s.width=t.width:t.height!==de?s.width=Math.round(t.height*(e.width/Math.max(e.height,1))):s.width=Math.round(e.width*r),t.height!==de?s.height=t.height:t.width!==de?s.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):s.height=Math.round(e.height*r)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(de),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return de}},T={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},qi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),opacity);}",$i="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",ea="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),opacity);}",ta="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",sa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),opacity);}",ra="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),opacity);}",na="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),opacity);}",ia="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),opacity);}",aa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),opacity);}",oa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),opacity);}",la="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),opacity);}",ca="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),opacity);}",ua="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),opacity);}",ha="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),opacity);}",fa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),opacity);}",da="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),opacity);}",Aa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",pa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),opacity);}",ma="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",Ba="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),opacity);}",va="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),opacity);}",ga="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),opacity);}",Ca="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Ea="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),opacity);}",Ma="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),opacity);}",Ta="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),opacity);}",xa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",Ra="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),opacity);}",Fa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),opacity);}",Da="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Sa="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),opacity);}",ba="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),opacity);}",Ia=new Map([[T.ADD,qi],[T.ALPHA,$i],[T.AVERAGE,ea],[T.COLOR,ta],[T.COLOR_BURN,sa],[T.COLOR_DODGE,ra],[T.DARKEN,na],[T.DIFFERENCE,ia],[T.DIVIDE,aa],[T.DST,null],[T.EXCLUSION,oa],[T.HARD_LIGHT,la],[T.HARD_MIX,ca],[T.HUE,ua],[T.INVERT,ha],[T.INVERT_RGB,fa],[T.LIGHTEN,da],[T.LINEAR_BURN,Aa],[T.LINEAR_DODGE,pa],[T.LINEAR_LIGHT,ma],[T.LUMINOSITY,Ba],[T.MULTIPLY,va],[T.NEGATION,ga],[T.NORMAL,Ca],[T.OVERLAY,Ea],[T.PIN_LIGHT,Ma],[T.REFLECT,Ta],[T.SATURATION,xa],[T.SCREEN,Ra],[T.SOFT_LIGHT,Fa],[T.SRC,Da],[T.SUBTRACT,Sa],[T.VIVID_LIGHT,ba]]),ya=class extends Lt{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new C(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return Ia.get(this.blendFunction)}},ye=class extends Lt{constructor(e,t,{attributes:s=Ae.NONE,blendFunction:r=T.NORMAL,defines:n=new Map,uniforms:i=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=i,this.extensions=a,this.blendMode=new ya(r),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Ws,this._outputColorSpace=Zs}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Be){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof j||t instanceof ze||t instanceof Ie||t instanceof Q)&&this[e].dispose()}}},lt={MEDIUM:2,LARGE:3},Ga=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,wa="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Ha=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],_a=class extends Z{constructor(e=new me){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new C(null),texelSize:new C(new me),scale:new C(1),kernel:new C(0)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ga,vertexShader:wa}),this.setTexelSize(e.x,e.y),this.kernelSize=lt.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return Ha[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,e*.5,t*.5)}setSize(e,t){const s=1/e,r=1/t;this.uniforms.texelSize.value.set(s,r,s*.5,r*.5)}},lr=class extends Q{constructor({kernelSize:e=lt.MEDIUM,resolutionScale:t=.5,width:s=L.AUTO_SIZE,height:r=L.AUTO_SIZE,resolutionX:n=s,resolutionY:i=r}={}){super("KawaseBlurPass"),this.renderTargetA=new j(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new L(this,n,i,t);a.addEventListener("change",o=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new _a,this._blurMaterial.kernelSize=e,this.copyMaterial=new ar}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,r,n){const i=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,h=c.kernelSequence;let u=t;this.fullscreenMaterial=c;for(let f=0,d=h.length;f<d;++f){const A=(f&1)===0?o:l;c.kernel=h[f],c.inputBuffer=u.texture,e.setRenderTarget(A),e.render(i,a),u=A}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=u.texture,e.setRenderTarget(this.renderToScreen?null:s),e.render(i,a)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t);const r=s.width,n=s.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTargetA.texture.type=s,this.renderTargetB.texture.type=s,s!==se?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e!==null&&e.outputColorSpace===_&&(this.renderTargetA.texture.colorSpace=_,this.renderTargetB.texture.colorSpace=_))}static get AUTO_SIZE(){return L.AUTO_SIZE}},Ua=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,Pa=class extends Z{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:nt.replace(/\D+/g,"")},uniforms:{inputBuffer:new C(null),threshold:new C(0),smoothing:new C(1),range:new C(null)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ua,vertexShader:We}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},La=class extends Q{constructor({renderTarget:e,luminanceRange:t,colorOutput:s,resolutionScale:r=1,width:n=L.AUTO_SIZE,height:i=L.AUTO_SIZE,resolutionX:a=n,resolutionY:o=i}={}){super("LuminancePass"),this.fullscreenMaterial=new Pa(s,t),this.needsSwap=!1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new j(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new L(this,a,o,r);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,s,r,n){const i=this.fullscreenMaterial;i.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height)}initialize(e,t,s){s!==void 0&&s!==se&&(this.renderTarget.texture.type=s,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Oa=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Na="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Ja=class extends Z{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new C(null),texelSize:new C(new y)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Oa,vertexShader:Na})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},ka=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Ka="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",za=class extends Z{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new C(null),supportBuffer:new C(null),texelSize:new C(new y),radius:new C(.85)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ka,vertexShader:Ka})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Qa=class extends Q{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new j(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Ja,this.upsamplingMaterial=new za,this.resolution=new y}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let s=0;s<e;++s){const r=t.clone();r.texture.name="Downsampling.Mipmap"+s,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(t);for(let s=1,r=e-1;s<r;++s){const n=t.clone();n.texture.name="Upsampling.Mipmap"+s,this.upsamplingMipmaps.push(n)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,s,r,n){const{scene:i,camera:a}=this,{downsamplingMaterial:o,upsamplingMaterial:l}=this,{downsamplingMipmaps:c,upsamplingMipmaps:h}=this;let u=t;this.fullscreenMaterial=o;for(let f=0,d=c.length;f<d;++f){const A=c[f];o.setSize(u.width,u.height),o.inputBuffer=u.texture,e.setRenderTarget(A),e.render(i,a),u=A}this.fullscreenMaterial=l;for(let f=h.length-1;f>=0;--f){const d=h[f];l.setSize(u.width,u.height),l.inputBuffer=u.texture,l.supportBuffer=c[f].texture,e.setRenderTarget(d),e.render(i,a),u=d}}setSize(e,t){const s=this.resolution;s.set(e,t);let r=s.width,n=s.height;for(let i=0,a=this.downsamplingMipmaps.length;i<a;++i)r=Math.round(r*.5),n=Math.round(n*.5),this.downsamplingMipmaps[i].setSize(r,n),i<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[i].setSize(r,n)}initialize(e,t,s){if(s!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const n of r)n.texture.type=s;if(s!==se)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(e!==null&&e.outputColorSpace===_)for(const n of r)n.texture.colorSpace=_}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},ja=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,Xa=class extends ye{constructor({blendFunction:e=T.SCREEN,luminanceThreshold:t=1,luminanceSmoothing:s=.03,mipmapBlur:r=!0,intensity:n=1,radius:i=.85,levels:a=8,kernelSize:o=lt.LARGE,resolutionScale:l=.5,width:c=L.AUTO_SIZE,height:h=L.AUTO_SIZE,resolutionX:u=c,resolutionY:f=h}={}){super("BloomEffect",ja,{blendFunction:e,uniforms:new Map([["map",new C(null)],["intensity",new C(n)]])}),this.renderTarget=new j(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new lr({kernelSize:o}),this.luminancePass=new La({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=s,this.mipmapBlurPass=new Qa,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=i,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new L(this,u,f,l);d.addEventListener("change",A=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,s){const r=this.renderTarget,n=this.luminancePass;n.enabled?(n.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,n.renderTarget):this.blurPass.render(e,n.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,r)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height),this.blurPass.resolution.copy(s),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,s){this.blurPass.initialize(e,t,s),this.luminancePass.initialize(e,t,s),this.mipmapBlurPass.initialize(e,t,s),s!==void 0&&(this.renderTarget.texture.type=s,e!==null&&e.outputColorSpace===_&&(this.renderTarget.texture.colorSpace=_))}},cr={RED:0,GREEN:1},Nt={DISCARD:0,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},Ya=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,et=class extends Z{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{inputBuffer:new C(null),cocBuffer:new C(null),texelSize:new C(new y),kernel64:new C(null),kernel16:new C(null),scale:new C(1)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ya,vertexShader:We}),t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.scale}setScale(e){this.scale=e}generateKernel(){const e=2.39996323,t=new Float64Array(128),s=new Float64Array(32);let r=0,n=0;for(let i=0,a=Math.sqrt(80);i<80;++i){const o=i*e,l=Math.sqrt(i)/a,c=l*Math.cos(o),h=l*Math.sin(o);i%5===0?(s[n++]=c,s[n++]=h):(t[r++]=c,t[r++]=h)}this.uniforms.kernel64.value=t,this.uniforms.kernel16.value=s}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function _s(e,t,s){return e*(t-s)-t}function yt(e,t,s){return Math.min(Math.max((e+t)/(t-s),0),1)}var Va=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Wa=class extends Z{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new C(null),focusDistance:new C(0),focusRange:new C(0),cameraNear:new C(.3),cameraFar:new C(1e3)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Va,vertexShader:We}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Be){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-_s(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=yt(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-_s(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=yt(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ot?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Za=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,qa=class extends Z{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new C(e),inputBuffer:new C(null),strength:new C(1)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Za,vertexShader:We}),this.colorChannel=cr.RED,this.maskFunction=Nt.DISCARD}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==se&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},Re=class extends Q{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.input=t}setInput(e){this.input=e}render(e,t,s,r,n){const i=this.fullscreenMaterial.uniforms;t!==null&&i!==void 0&&i[this.input]!==void 0&&(i[this.input].value=t.texture),e.setRenderTarget(this.renderToScreen?null:s),e.render(this.scene,this.camera)}initialize(e,t,s){s!==void 0&&s!==se&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},$a=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,eo=class extends ye{constructor(e,{blendFunction:t,worldFocusDistance:s,worldFocusRange:r,focusDistance:n=0,focalLength:i=.1,focusRange:a=i,bokehScale:o=1,resolutionScale:l=1,width:c=L.AUTO_SIZE,height:h=L.AUTO_SIZE,resolutionX:u=c,resolutionY:f=h}={}){super("DepthOfFieldEffect",$a,{blendFunction:t,attributes:Ae.DEPTH,uniforms:new Map([["nearColorBuffer",new C(null)],["farColorBuffer",new C(null)],["nearCoCBuffer",new C(null)],["farCoCBuffer",new C(null)],["scale",new C(1)]])}),this.camera=e,this.renderTarget=new j(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Re(new Wa(e));const d=this.cocMaterial;d.focusDistance=n,d.focusRange=a,s!==void 0&&(d.worldFocusDistance=s),r!==void 0&&(d.worldFocusRange=r),this.blurPass=new lr({resolutionScale:l,resolutionX:u,resolutionY:f,kernelSize:lt.MEDIUM}),this.maskPass=new Re(new qa(this.renderTargetCoC.texture));const A=this.maskPass.fullscreenMaterial;A.colorChannel=cr.GREEN,this.maskFunction=Nt.MULTIPLY_RGB,this.bokehNearBasePass=new Re(new et(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Re(new et(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Re(new et(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Re(new et(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const p=this.resolution=new L(this,u,f,l);p.addEventListener("change",B=>this.setSize(p.baseWidth,p.baseHeight)),this.bokehScale=o}set mainCamera(e){this.camera=e,this.cocMaterial.copyCameraSettings(e)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(e){this.maskFunction!==e&&(this.defines.set("MASK_FUNCTION",e.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=e,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){this.bokehNearBasePass.fullscreenMaterial.scale=e,this.bokehNearFillPass.fullscreenMaterial.scale=e,this.bokehFarBasePass.fullscreenMaterial.scale=e,this.bokehFarFillPass.fullscreenMaterial.scale=e,this.maskPass.fullscreenMaterial.strength=e,this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){const t=this.camera,s=t.position.distanceTo(e);return yt(-s,t.near,t.far)}setDepthTexture(e,t=Be){this.cocMaterial.depthBuffer=e,this.cocMaterial.depthPacking=t}update(e,t,s){const r=this.renderTarget,n=this.renderTargetCoC,i=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){const o=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,i),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t);const r=s.width,n=s.height;this.cocPass.setSize(e,t),this.blurPass.setSize(e,t),this.maskPass.setSize(e,t),this.renderTargetFar.setSize(e,t),this.renderTargetCoC.setSize(e,t),this.renderTargetMasked.setSize(e,t),this.renderTarget.setSize(r,n),this.renderTargetNear.setSize(r,n),this.renderTargetCoCBlurred.setSize(r,n),this.bokehNearBasePass.fullscreenMaterial.setSize(e,t),this.bokehNearFillPass.fullscreenMaterial.setSize(e,t),this.bokehFarBasePass.fullscreenMaterial.setSize(e,t),this.bokehFarFillPass.fullscreenMaterial.setSize(e,t)}initialize(e,t,s){this.cocPass.initialize(e,t,s),this.maskPass.initialize(e,t,s),this.bokehNearBasePass.initialize(e,t,s),this.bokehNearFillPass.initialize(e,t,s),this.bokehFarBasePass.initialize(e,t,s),this.bokehFarFillPass.initialize(e,t,s),this.blurPass.initialize(e,t,se),e.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),s!==void 0&&(this.renderTarget.texture.type=s,this.renderTargetNear.texture.type=s,this.renderTargetFar.texture.type=s,this.renderTargetMasked.texture.type=s,e!==null&&e.outputColorSpace===_&&(this.renderTarget.texture.colorSpace=_,this.renderTargetNear.texture.colorSpace=_,this.renderTargetFar.texture.colorSpace=_,this.renderTargetMasked.texture.colorSpace=_))}},ur=class extends Q{constructor(e,t,s=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new or,this.overrideMaterialManager=s===null?null:new Hs(s),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new Hs(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,s,r,n){const i=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=i.background,h=e.shadowMap.autoUpdate,u=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(i.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,i,a):e.render(i,a),a.layers.mask=l,i.background=c,e.shadowMap.autoUpdate=h}},Ne={DEFAULT:0,ESKIL:1},to=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*(1.0+time)));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,so=class extends ye{constructor({blendFunction:e=T.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",to,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},ro=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,no="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",io=class extends Z{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new C(null),normalBuffer:new C(null),texelSize:new C(new y)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ro,vertexShader:no})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Be){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,e!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},ao=class extends Q{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:s=L.AUTO_SIZE,height:r=L.AUTO_SIZE,resolutionX:n=s,resolutionY:i=r}={}){super("DepthDownsamplingPass");const a=new io;a.normalBuffer=e,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new j(1,1,{minFilter:Ye,magFilter:Ye,depthBuffer:!1,type:fn}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const o=this.resolution=new L(this,n,i,t);o.addEventListener("change",l=>this.setSize(o.baseWidth,o.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=Be){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,s,r,n){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,s){const r=e.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},oo=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,lo=class extends ye{constructor({blendFunction:e,eskil:t=!1,technique:s=t?Ne.ESKIL:Ne.DEFAULT,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",oo,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",s.toFixed(0)]]),uniforms:new Map([["offset",new C(r)],["darkness",new C(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Ne.ESKIL}set eskil(e){this.technique=e?Ne.ESKIL:Ne.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},co=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,uo="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",ho=class extends Z{constructor(e,t,s,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:nt.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new C(null),depthBuffer:new C(null),resolution:new C(new y),texelSize:new C(new y),cameraNear:new C(.3),cameraFar:new C(1e3),aspect:new C(1),time:new C(0)},blending:ee,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:n}),e&&this.setShaderParts(e),t&&this.setDefines(t),s&&this.setUniforms(s),this.copyCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Be){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=co.replace(S.FRAGMENT_HEAD,e.get(S.FRAGMENT_HEAD)||"").replace(S.FRAGMENT_MAIN_UV,e.get(S.FRAGMENT_MAIN_UV)||"").replace(S.FRAGMENT_MAIN_IMAGE,e.get(S.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=uo.replace(S.VERTEX_HEAD,e.get(S.VERTEX_HEAD)||"").replace(S.VERTEX_MAIN_SUPPORT,e.get(S.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ot?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const s=this.uniforms;s.resolution.value.set(e,t),s.texelSize.value.set(1/e,1/t),s.aspect.value=e/t}static get Section(){return S}};function Us(e,t,s){for(const r of t){const n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),i=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const a of s.entries())a[1]!==null&&s.set(a[0],a[1].replace(i,n))}}function fo(e,t,s){let r=t.getFragmentShader(),n=t.getVertexShader();const i=r!==void 0&&/mainImage/.test(r),a=r!==void 0&&/mainUv/.test(r);if(s.attributes|=t.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(a&&(s.attributes&Ae.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!i&&!a)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const o=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=s.shaderParts;let c=l.get(S.FRAGMENT_HEAD)||"",h=l.get(S.FRAGMENT_MAIN_UV)||"",u=l.get(S.FRAGMENT_MAIN_IMAGE)||"",f=l.get(S.VERTEX_HEAD)||"",d=l.get(S.VERTEX_MAIN_SUPPORT)||"";const A=new Set,p=new Set;if(a&&(h+=`	${e}MainUv(UV);
`,s.uvTransformation=!0),n!==null&&/mainSupport/.test(n)){const v=/mainSupport *\([\w\s]*?uv\s*?\)/.test(n);d+=`	${e}MainSupport(`,d+=v?`vUv);
`:`);
`;for(const g of n.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const M of g[1].split(/\s*,\s*/))s.varyings.add(M),A.add(M),p.add(M);for(const g of n.matchAll(o))p.add(g[1])}for(const v of r.matchAll(o))p.add(v[1]);for(const v of t.defines.keys())p.add(v.replace(/\([\w\s,]*\)/g,""));for(const v of t.uniforms.keys())p.add(v);p.delete("while"),p.delete("for"),p.delete("if"),t.uniforms.forEach((v,g)=>s.uniforms.set(e+g.charAt(0).toUpperCase()+g.slice(1),v)),t.defines.forEach((v,g)=>s.defines.set(e+g.charAt(0).toUpperCase()+g.slice(1),v));const B=new Map([["fragment",r],["vertex",n]]);Us(e,p,s.defines),Us(e,p,B),r=B.get("fragment"),n=B.get("vertex");const m=t.blendMode;if(s.blendModes.set(m.blendFunction,m),i){t.inputColorSpace!==null&&t.inputColorSpace!==s.colorSpace&&(u+=t.inputColorSpace===_?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==Zs?s.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(s.colorSpace=t.inputColorSpace);const v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;u+=`${e}MainImage(color0, UV, `,(s.attributes&Ae.DEPTH)!==0&&v.test(r)&&(u+="depth, ",s.readDepth=!0),u+=`color1);
	`;const g=e+"BlendOpacity";s.uniforms.set(g,m.opacity),u+=`color0 = blend${m.blendFunction}(color0, color1, ${g});

	`,c+=`uniform float ${g};

`}if(c+=r+`
`,n!==null&&(f+=n+`
`),l.set(S.FRAGMENT_HEAD,c),l.set(S.FRAGMENT_MAIN_UV,h),l.set(S.FRAGMENT_MAIN_IMAGE,u),l.set(S.VERTEX_HEAD,f),l.set(S.VERTEX_MAIN_SUPPORT,d),t.extensions!==null)for(const v of t.extensions)s.extensions.add(v)}}var Ao=class extends Q{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new ho(null,null,null,e),this.listener=s=>this.handleEvent(s),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,s)=>s.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new Zi;let t=0;for(const a of this.effects)if(a.blendMode.blendFunction===T.DST)e.attributes|=a.getAttributes()&Ae.DEPTH;else{if((e.attributes&a.getAttributes()&Ae.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${a.name})`);fo("e"+t++,a,e)}let s=e.shaderParts.get(S.FRAGMENT_HEAD),r=e.shaderParts.get(S.FRAGMENT_MAIN_IMAGE),n=e.shaderParts.get(S.FRAGMENT_MAIN_UV);const i=/\bblend\b/g;for(const a of e.blendModes.values())s+=a.getShaderCode().replace(i,`blend${a.blendFunction}`)+`
`;(e.attributes&Ae.DEPTH)!==0?(e.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===_&&(r+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(n=`vec2 transformedUv = vUv;
`+n,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(S.FRAGMENT_HEAD,s),e.shaderParts.set(S.FRAGMENT_MAIN_IMAGE,r),e.shaderParts.set(S.FRAGMENT_MAIN_UV,n);for(const[a,o]of e.shaderParts)o!==null&&e.shaderParts.set(a,o.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Be){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const s of this.effects)s.setDepthTexture(e,t)}render(e,t,s,r,n){for(const i of this.effects)i.update(e,t,r);if(!this.skipRendering||this.renderToScreen){const i=this.fullscreenMaterial;i.inputBuffer=t.texture,i.time+=r*this.timeScale,e.setRenderTarget(this.renderToScreen?null:s),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const s of this.effects)s.setSize(e,t)}initialize(e,t,s){this.renderer=e;for(const r of this.effects)r.initialize(e,t,s);this.updateMaterial(),s!==void 0&&s!==se&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},po=class extends Q{constructor(e,t,{renderTarget:s,resolutionScale:r=1,width:n=L.AUTO_SIZE,height:i=L.AUTO_SIZE,resolutionX:a=n,resolutionY:o=i}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new ur(e,t,new hn);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new z(7829503),c.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new j(1,1,{minFilter:Ye,magFilter:Ye}),this.renderTarget.texture.name="NormalPass.Target");const h=this.resolution=new L(this,a,o,r);h.addEventListener("change",u=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,r,n){const i=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,i,i)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height)}};function Xe(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}new y;new y;function hr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var V=function e(t,s,r){var n=this;hr(this,e),Xe(this,"dot2",function(i,a){return n.x*i+n.y*a}),Xe(this,"dot3",function(i,a,o){return n.x*i+n.y*a+n.z*o}),this.x=t,this.y=s,this.z=r},mo=[new V(1,1,0),new V(-1,1,0),new V(1,-1,0),new V(-1,-1,0),new V(1,0,1),new V(-1,0,1),new V(1,0,-1),new V(-1,0,-1),new V(0,1,1),new V(0,-1,1),new V(0,1,-1),new V(0,-1,-1)],Ps=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Ls=new Array(512),Os=new Array(512),Bo=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var s=0;s<256;s++){var r;s&1?r=Ps[s]^t&255:r=Ps[s]^t>>8&255,Ls[s]=Ls[s+256]=r,Os[s]=Os[s+256]=mo[r%12]}};Bo(0);function vo(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var s=0;s<t.length;s++)e=(e+(s+1)*(t.charCodeAt(s)%96))%2147483647}return e===0&&(e=311),e}function Ns(e){var t=vo(e);return function(){var s=t*48271%2147483647;return t=s,s/2147483647}}var go=function e(t){var s=this;hr(this,e),Xe(this,"seed",0),Xe(this,"init",function(r){s.seed=r,s.value=Ns(r)}),Xe(this,"value",Ns(this.seed)),this.init(t)};new go(Math.random());const fr=E.createContext(null),Js=e=>(e.getAttributes()&2)===2,Co=E.memo(E.forwardRef(({children:e,camera:t,scene:s,resolutionScale:r,enabled:n=!0,renderPriority:i=1,autoClear:a=!0,depthBuffer:o,enableNormalPass:l,stencilBuffer:c,multisampling:h=8,frameBufferType:u=Ut},f)=>{const{gl:d,scene:A,camera:p,size:B}=De(),m=s||A,v=t||p,[g,M,D]=E.useMemo(()=>{const b=new Wi(d,{depthBuffer:o,stencilBuffer:c,multisampling:h,frameBufferType:u});b.addPass(new ur(m,v));let I=null,F=null;return l&&(F=new po(m,v),F.enabled=!1,b.addPass(F),r!==void 0&&(I=new ao({normalBuffer:F.texture,resolutionScale:r}),I.enabled=!1,b.addPass(I))),[b,F,I]},[v,d,o,c,h,u,m,l,r]);E.useEffect(()=>g?.setSize(B.width,B.height),[g,B]),Pt((b,I)=>{if(n){const F=d.autoClear;d.autoClear=a,c&&!a&&d.clearStencil(),g.render(I),d.autoClear=F}},n?i:0);const G=E.useRef(null);E.useLayoutEffect(()=>{const b=[],I=G.current.__r3f;if(I&&g){const F=I.children;for(let K=0;K<F.length;K++){const O=F[K].object;if(O instanceof ye){const q=[O];if(!Js(O)){let X=null;for(;(X=F[K+1]?.object)instanceof ye&&!Js(X);)q.push(X),K++}const le=new Ao(v,...q);b.push(le)}else O instanceof Q&&b.push(O)}for(const K of b)g?.addPass(K);M&&(M.enabled=!0),D&&(D.enabled=!0)}return()=>{for(const F of b)g?.removePass(F);M&&(M.enabled=!1),D&&(D.enabled=!1)}},[g,e,v,M,D]),E.useEffect(()=>{const b=d.toneMapping;return d.toneMapping=dn,()=>{d.toneMapping=b}},[d]);const w=E.useMemo(()=>({composer:g,normalPass:M,downSamplingPass:D,resolutionScale:r,camera:v,scene:m}),[g,M,D,r,v,m]);return E.useImperativeHandle(f,()=>g,[g]),R.jsx(fr.Provider,{value:w,children:R.jsx("group",{ref:G,children:e})})}));let Eo=0;const ks=new WeakMap,Jt=(e,t)=>function({blendFunction:s=t?.blendFunction,opacity:r=t?.opacity,...n}){let i=ks.get(e);if(!i){const l=`@react-three/postprocessing/${e.name}-${Eo++}`;Gt({[l]:e}),ks.set(e,i=l)}const a=De(l=>l.camera),o=qs.useMemo(()=>[...t?.args??[],...n.args??[{...t,...n}]],[JSON.stringify(n)]);return R.jsx(i,{camera:a,"blendMode-blendFunction":s,"blendMode-opacity-value":r,...n,args:o})},Mo=E.forwardRef(function({blendFunction:e,worldFocusDistance:t,worldFocusRange:s,focusDistance:r,focusRange:n,focalLength:i,bokehScale:a,resolutionScale:o,resolutionX:l,resolutionY:c,width:h,height:u,target:f,depthTexture:d,...A},p){const{camera:B}=E.useContext(fr),m=f!=null,v=E.useMemo(()=>{const g=new eo(B,{blendFunction:e,worldFocusDistance:t,worldFocusRange:s,focusDistance:r,focusRange:n,focalLength:i,bokehScale:a,resolutionScale:o,resolutionX:l,resolutionY:c,width:h,height:u});m&&(g.target=new U),d&&g.setDepthTexture(d.texture,d.packing);const M=g.maskPass;return M.maskFunction=Nt.MULTIPLY_RGB_SET_ALPHA,g},[B,e,t,s,r,n,i,a,o,l,c,h,u,m,d]);return E.useEffect(()=>()=>{v.dispose()},[v]),R.jsx("primitive",{...A,ref:p,object:v,target:f})}),To=Jt(Xa,{blendFunction:0}),xo=Jt(so,{blendFunction:5}),Ro=Jt(lo);function Fo(){const e=je("worn-rusted-painted-bl/worn-rusted-painted_roughness.png");return je("worn-rusted-painted-bl/worn-rusted-painted_normal-ogl.png"),je("worn-rusted-painted-bl/worn-rusted-painted_metallic.png"),R.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[-5,-13.5,5],children:[R.jsx("planeGeometry",{args:[150,150]}),R.jsx(ki,{blur:[30,20],resolution:1024,mixBlur:.5,mixStrength:800,roughnessMap:e,roughness:1,depthScale:3,minDepthThreshold:.8,maxDepthThreshold:1.2,color:"#111111",metalness:1})]})}function Do(e,{muted:t=!0,loop:s=!0,rotation:r=Math.PI/2}={}){const n=document.createElement("video");n.src=e,n.crossOrigin="Anonymous",n.loop=s,n.muted=t,n.playsInline=!0,n.autoplay=!0,n.play();const i=new An(n);return i.encoding=void 0,i.flipY=!0,i.center.set(.5,.5),i.rotation=r,{video:n,texture:i}}function So({video1:e,video2:t,video3:s,video4:r,video5:n,video6:i,video7:a,video8:o,video9:l,video10:c,setMainVideo:h,modelRef:u}){const f=Ve("tv_scene/tv_scene_F.glb"),d=E.useRef({});return E.useEffect(()=>{if(!u.current)return;Object.keys(d.current).length===0&&([{src:e,name:"tv1",muted:!0},{src:t,name:"tv2",muted:!0},{src:s,name:"tv3",muted:!0},{src:r,name:"tv4",muted:!0},{src:n,name:"tv5",muted:!0},{src:i,name:"tv6",muted:!0},{src:a,name:"tv7",muted:!0},{src:o,name:"tv8",muted:!0},{src:l,name:"tv9",muted:!0},{src:c,name:"tv10",muted:!0}].forEach(({src:m,name:v,muted:g})=>{m&&(d.current[v]=Do(m,{muted:g}))}),d.current.tv1?.video&&h(d.current.tv1.video));const A={};u.current.traverse(B=>{B.isMesh&&B.material?.name?.startsWith("tv")&&(A[B.material.name]=B.material)});const p=B=>{const m=A[B],v=d.current[B];m&&v?.texture&&(m.map=v.texture,m.emissive=new z(16777215),m.emissiveMap=v.texture,m.emissiveIntensity=.9,m.color.set(16777215),m.needsUpdate=!0)};return p("tv1"),p("tv2"),p("tv3"),p("tv4"),p("tv5"),p("tv6"),p("tv7"),p("tv8"),p("tv9"),p("tv10"),()=>{Object.values(d.current).forEach(({video:B,texture:m})=>{B.pause(),m.dispose()}),d.current={}}},[e,t,s,r,n,i,a,o,l,c]),R.jsx("primitive",{ref:u,object:f.scene,scale:1,position:[0,-15,-45],rotation:[0,1.58,0]})}function bo({url:e,emissiveColor:t="#ffffff",emissiveIntensity:s=-.01,outlineColor:r="#353535",outlineThickness:n=.002}){const i=E.useRef(),a=E.useRef(),{scene:o}=Ve(e);return E.useEffect(()=>{if(!o)return;const l=o.clone();o.traverse((c,h)=>{if(c.isMesh){const u=c.material;c.castShadow=!1,c.receiveShadow=!1,c.material=new pn({color:u.color?u.color.clone():new z("white"),map:u.map||null,emissive:new z(t),emissiveIntensity:s,transparent:u.transparent||!1,opacity:u.opacity??1,alphaMap:u.alphaMap||null,side:_t,depthWrite:u.depthWrite??!0})}}),l.traverse(c=>{c.isMesh&&(c.material=new Fe({color:new z(r),side:ke}),c.scale.multiplyScalar(1+n))}),a.current=l},[o,t,s,r,n]),R.jsxs(R.Fragment,{children:[R.jsx("primitive",{ref:i,object:o,rotation:[0,0,0],scale:[15,15,15],position:[.5,-13,-20]}),a.current&&R.jsx("primitive",{object:a.current,rotation:[0,0,0],scale:[15,15,15],position:[.5,-13,-20]})]})}function Io(){Pt((e,t)=>{qn.damp3(e.camera.position,[-1+e.pointer.x*e.viewport.width/3,(1+e.pointer.y)/2,5.5],1,t),e.camera.lookAt(0,.7,-10)})}function yo({setMainVideo:e,modelRef:t,setModelLoaded:s,performanceMode:r}){return R.jsxs(Mn,{camera:{position:[0,0,3],fov:45},dpr:r?[.7,1]:[1,1.5],children:[R.jsx("directionalLight",{position:[5,5,5],rotation:0,intensity:.1}),R.jsx("hemisphereLight",{skyColor:16777215,groundColor:4473924,intensity:.5}),R.jsx("spotLight",{position:[5,24,-20],angle:Math.PI/3,intensity:3,penumbra:.1,color:16777215,decay:0}),R.jsx("ambientLight",{intensity:r?2:.5}),R.jsx(Fo,{}),R.jsx(bo,{url:"animefe.glb",frustumCulled:!1}),R.jsx(Io,{}),!r&&R.jsxs(Co,{disableNormalPass:!0,children:[R.jsx(Mo,{focusDistance:.06,focalLength:.09,bokehScale:1,height:580}),R.jsx(To,{luminanceThreshold:0,mipmapBlur:!0,luminanceSmoothing:.3,intensity:.1}),R.jsx(Ro,{offset:.8,darkness:.4,eskil:!1,blendFunction:T.NORMAL}),R.jsx(xo,{opacity:.03})]}),R.jsx(So,{modelRef:t,video1:r?"testvideo21.mp4":"testvideo2.mp4",video2:r?"tvbars1.mp4":"tvbars.mp4",video3:"tvbars.mp4",video4:"testvideo2.mp4",video5:"tvbars.mp4",video6:"testvideo2.mp4",video7:r?"tvstatic1.mp4":"tvstatic.mp4",video8:r?"tvstatic1.mp4":"tvstatic.mp4",video9:r?"testvideo21.mp4":"testvideo2.mp4",video10:r?"testvideo21.mp4":"testvideo2.mp4",setMainVideo:e,setModelLoaded:s})]})}const Ho=qs.memo(yo);export{Ho as default};
